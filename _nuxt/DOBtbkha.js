var ve=Object.defineProperty;var me=(r,t,e)=>t in r?ve(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Jt=(r,t,e)=>me(r,typeof t!="symbol"?t+"":t,e);import{I as $t,k as Y,d as Ut,r as lt,o as At,J as ae,x as B,y as L,z as g,B as H,C as yt,K as ut,A as C,L as y,T as vt,M as R,N as Lt,D as Q,_ as ie,O as N,a as be,P as we,Q as qt,R as Me,G as Se,S as xt,U as oe,V as ne,s as $,W as Te,X as re,Y as Ee,Z as Re,$ as Tt,a0 as Et,a1 as De,a2 as Pe,a3 as ke,a4 as Ae,a5 as Ce,a6 as _e,a7 as Ie}from"./e9L6FHN1.js";import le from"./yWFBYj2g.js";const w={POINT_COUNT:60,MAX_METEORS:20,GRAVITY_RADIUS_BASE:700,START_RADIUS:20,CRITICAL_MASS:300,MASS_GAIN_METEOR:2,MASS_GAIN_SHIP:10,BOMB_DAMAGE:6,SHIP_COUNT:4,SHIP_SPEED:4,SHIP_TURN_SPEED:.12,SHIP_SEPARATION:80,SHIP_ENGAGEMENT_DIST:600,POWERUP_RATE:.015,POWERUP_DURATION:600,SIZE_MODIFIER_BIG:1.8,SIZE_MODIFIER_SMALL:.6,MAX_TRAIL_LENGTH:30,MAX_BIG_METEOR_TRAIL:30,MAX_MISSILE_TRAIL:15,MAX_SERPENT_SEGMENTS:40,COLORS:{primary:"#8b5cf6",secondary:"#06b6d4",danger:"#f43f5e",repel:"#f59e0b",shipEngines:"#facc15",white:"#ffffff",bg:"#0a0a0a",bomb:"#ef4444",buff:"#10b981",debuff:"#a855f7",shield:"#3b82f6"}},j={ROAM:"ROAM",DOGFIGHT:"DOGFIGHT",PANIC:"PANIC"},F={SERPENT:"SERPENT",SHIP:"SHIP",POINT:"POINT",POWERUP:"POWERUP",BIG_METEOR:"BIG_METEOR"},dt={CHARGE:"CHARGE",FLANK:"FLANK",RETREAT:"RETREAT"};var k=(r=>(r[r.STABLE=0]="STABLE",r[r.UNSTABLE=1]="UNSTABLE",r[r.EXPLODING=2]="EXPLODING",r[r.REFORMING=3]="REFORMING",r))(k||{});class u{static dist(t,e){const s=t.x-e.x,a=t.y-e.y;return Math.sqrt(s*s+a*a)}static distSq(t,e){const s=t.x-e.x,a=t.y-e.y;return s*s+a*a}static angle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static randomRange(t,e){return Math.random()*(e-t)+t}static randomChoice(t){if(t.length===0)throw new Error("Array is empty");return t[Math.floor(Math.random()*t.length)]}static normalizeAngle(t){let e=t;for(;e<-Math.PI;)e+=Math.PI*2;for(;e>Math.PI;)e-=Math.PI*2;return e}static randomColor(){const t=Math.floor(Math.random()*360),e=Math.floor(Math.random()*30)+70,s=Math.floor(Math.random()*40)+40;return`hsl(${t}, ${e}%, ${s}%)`}}class V{x;y;vx=0;vy=0;color;markedForDeletion=!1;constructor(t,e,s){this.x=t,this.y=e,this.color=s}get posX(){return this.x}get posY(){return this.y}get entityColor(){return this.color}applyPhysics(t=1,e=1){this.x+=this.vx*t,this.y+=this.vy*t,this.vx*=e,this.vy*=e}}class Ct extends V{damage;size;life;maxLife;constructor(t,e,s,a,i,n,o,l){super(t,e,i),this.vx=s,this.vy=a,this.damage=n,this.size=o,this.life=l,this.maxLife=l}checkCollisions(t){}createHitEffect(t,e){e&&e(this.x,this.y,this.color)}shouldDeleteOnHit(){return!0}update(t){if(this.life--,this.life<=0){this.markedForDeletion=!0;return}this.applyPhysics(t.warpFactor),this.checkCollisions(t)}}class U{tryTeleport(t,e){return!1}tryFireBomb(t,e){return!1}getIcon(){return this.icon}}class Oe extends V{radius=1;maxRadius=250;life=1;constructor(t,e){super(t,e,"#ffffff")}update(t){this.radius+=8*t.warpFactor,this.life-=.03,this.life<=0&&(this.markedForDeletion=!0)}draw(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.strokeStyle=`rgba(255, 200, 200, ${this.life})`,t.lineWidth=20*this.life,t.stroke(),t.restore()}}class ce extends V{text;life=1;size=20;constructor(t,e,s,a){super(t,e,a),this.text=s,this.vy=-1.5,this.vx=u.randomRange(-.5,.5)}update(t){this.x+=this.vx,this.y+=this.vy,this.life-=.02,this.life<=0&&(this.markedForDeletion=!0)}draw(t){t.save(),t.globalAlpha=this.life,t.fillStyle=this.color,t.font=`bold ${this.size}px monospace`,t.textAlign="center",t.shadowColor="#000",t.shadowBlur=4,t.fillText(this.text,this.x,this.y),t.restore()}}class jt extends ce{constructor(t,e,s,a=!1){const i=Math.floor(s).toString(),n=a?"#ef4444":"#ffffff",o=a?24:14,l=u.randomRange(-10,10),c=u.randomRange(-10,10);super(t+l,e+c,i,n),this.size=o,a&&(this.vy=-2,this.vx=u.randomRange(-1,1))}static create(t,e,s,a=!1){return new jt(t,e,s,a)}}class ht extends ce{constructor(t,e,s){const a=`+${Math.floor(s)}$`,i="#fbbf24",n=18,o=u.randomRange(-10,10),l=u.randomRange(-10,10);super(t+o,e+l,a,i),this.size=n,this.vy=-1.2,this.vx=u.randomRange(-.3,.3)}static create(t,e,s){return new ht(t,e,s)}}const v=$t({coins:0,darkMatter:0,shipsCount:4,damageLevel:1,hullLevel:1,turretSpeed:1,shieldLevel:0,critLevel:0,regenLevel:0,magnetLevel:1,blackHoleSerpentCostDebuff:0,blackHoleBalanceRateDebuff:0,blackHoleDarkMatterRateDebuff:0}),I=Y(()=>{const r=(t,e,s)=>Math.floor(t*Math.pow(e,s));return{ship:r(1e3,2.2,v.shipsCount-4),damage:r(250,1.4,v.damageLevel-1),turret:r(300,1.45,v.turretSpeed-1),hull:r(200,1.35,v.hullLevel-1),shield:r(400,1.4,v.shieldLevel),crit:r(500,1.6,v.critLevel),regen:r(600,1.6,v.regenLevel),magnet:r(300,1.5,v.magnetLevel-1),blackHoleSerpentCost:r(400,1.5,v.blackHoleSerpentCostDebuff),blackHoleBalanceRate:r(500,1.6,v.blackHoleBalanceRateDebuff),blackHoleDarkMatterRate:r(600,1.7,v.blackHoleDarkMatterRateDebuff)}}),O=r=>{const t=I.value[r];v.coins>=t&&(v.coins-=t,r==="ship"?(v.shipsCount++,w.SHIP_COUNT=v.shipsCount):r==="damage"?v.damageLevel++:r==="hull"?v.hullLevel++:r==="turret"?v.turretSpeed++:r==="shield"?v.shieldLevel++:r==="crit"?v.critLevel++:r==="regen"?v.regenLevel++:r==="magnet"?v.magnetLevel++:r==="blackHoleSerpentCost"?v.blackHoleSerpentCostDebuff++:r==="blackHoleBalanceRate"?v.blackHoleBalanceRateDebuff++:r==="blackHoleDarkMatterRate"&&v.blackHoleDarkMatterRateDebuff++)};class Le{static applyAoeDamage(t,e,s,a,i){const n=[],o=s*s;for(const l of i){let c=!1;for(const h of l.segments)if(u.distSq({x:t,y:e},h)<o){c=!0;break}if(c){const h=u.angle({x:t,y:e},l);n.push({serpent:l,damage:a,pushAngle:h})}}return n}}class he{static getAvoidanceVector(t,e,s){let a=0,i=0;const n=s*s;for(const o of e){if(o===t)continue;const l=o.x-t.x,c=o.y-t.y,h=l*l+c*c;if(h<n&&h>0){const d=Math.sqrt(h),p=1-d/s;a-=l/d*p,i-=c/d*p}}return{x:a,y:i}}static getPathToTarget(t,e,s){const a=u.angle(t,e);if(t.state===j.PANIC)return u.angle(s,t);const i=u.distSq(t,s),n=u.distSq(t,e),o=u.angle(t,s),l=Math.abs(u.normalizeAngle(a-o)),c=500*500;if(s.state!==k.EXPLODING&&i<n&&l<.8&&i<c){const h=u.normalizeAngle(o-t.angle)>0?-1:1;return o+Math.PI/2*h}return a}}class tt{cooldownTimer=0;cachedVisual=null;update(){this.cooldownTimer>0&&this.cooldownTimer--}get isReady(){return this.cooldownTimer<=0}fire(t,e,s,a,i){return this.isReady?(this.spawnProjectiles(t,e,s,a),this.cooldownTimer=this.config.cooldown/i,!0):!1}getVisual(t,e){return this.cachedVisual||(this.cachedVisual=this.generateVisual(t,e)),this.cachedVisual}getAllowedAngle(){return .5}getRange(t){return t+100}}function K(r,t){r.shadowColor=t.color,r.shadowBlur=t.blur*t.intensity,t.spread!==void 0&&(r.shadowOffsetX=0,r.shadowOffsetY=0)}function Be(r,t,e=1){return r*(.7+.3*Math.sin(t*e))}class Ge extends Ct{drawSpecific(t){const e=Math.atan2(this.vy,this.vx);t.rotate(e);const s=this.size>3?30:10;t.save(),K(t,{color:this.color,intensity:1,blur:15+this.size*5}),t.beginPath(),t.moveTo(0,0),t.lineTo(-s,0),t.strokeStyle=this.color,t.lineWidth=this.size,t.stroke(),t.restore()}}class ze{cache=new Map;maxSize=100;createCanvas(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s}get(t){return this.cache.get(t)}set(t,e){if(this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s&&this.cache.delete(s)}this.cache.set(t,e)}has(t){return this.cache.has(t)}clear(){this.cache.clear()}generateKey(t,e){const s=Object.entries(e).sort(([a],[i])=>a.localeCompare(i)).map(([a,i])=>`${a}:${i}`).join("|");return`${t}:${s}`}}const et=new ze;class Bt extends tt{config={cooldown:40,damage:1,speed:12,spread:.05,color:null,size:2};icon="";duration=600;spawnProjectiles(t,e,s,a){const i=(Math.random()-.5)*this.config.spread,n=e.vx+Math.cos(s+i)*this.config.speed,o=e.vy+Math.sin(s+i)*this.config.speed,l=t.projectilePool.acquireLinear(e.x,e.y,n,o,e.color,this.config.damage*a,this.config.size,60);t.projectiles.add(l)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");return a.save(),a.strokeStyle="#8b5cf6",a.shadowColor="#8b5cf6",a.shadowBlur=15,a.lineWidth=2,a.beginPath(),a.moveTo(t/2,e/2),a.lineTo(t/2-20,e/2),a.stroke(),a.restore(),{canvas:s,width:t,height:e,key:"blaster"}}}class ot{static getDamageMultiplier(){return 1+(v.damageLevel-1)*.2}static getReloadMultiplier(){return 1+(v.turretSpeed-1)*.15}static getRegenRate(){return Math.max(60,360-v.regenLevel*60)}static getRegenLevel(){return v.regenLevel}static getCritLevel(){return v.critLevel}static getHullLevel(){return v.hullLevel}static getShieldLevel(){return v.shieldLevel}}class Wt{static instance=null;static getInstance(){return this.instance||(this.instance=new Wt),this.instance}updateRegen(t,e){if(ot.getRegenLevel()===0||t.hp===void 0||t.maxHp===void 0||t.hp>=t.maxHp)return!1;e.value++;const s=ot.getRegenRate();return e.value>s?(t.hp++,e.value=0,!0):!1}}class Pt{static calculateCritDamage(t,e){const a=(e??ot.getCritLevel())*.05;return Math.random()<a?{damage:t*2,isCrit:!0}:{damage:t,isCrit:!1}}}class ct{static calculateGravityPull(t,e){if(e.state===k.EXPLODING)return null;const s=u.distSq(t,e),a=u.angle(t,e),i=.1+e.mass/w.CRITICAL_MASS*.9,n=w.GRAVITY_RADIUS_BASE*(.5+i*.5),o=n*n;if(s<o){const l=Math.sqrt(s),c=.3*i*(1-l/n);return{vx:Math.cos(a)*c,vy:Math.sin(a)*c}}return null}static shouldDieFromGravity(t,e){if(e.state===k.EXPLODING)return!1;const s=u.distSq(t,e),a=e.visualRadius*e.visualRadius;return s<a}static shouldDieFromShockwave(t,e){if(e.state!==k.EXPLODING)return!1;const s=u.distSq(t,e),a=(e.shockwaveRadius+50)*(e.shockwaveRadius+50);return s<a}}class de{static updateEffects(t){t.sizeMult!==void 0&&(t.sizeMult=1),t.speedMult!==void 0&&(t.speedMult=1),t.damageMult!==void 0&&(t.damageMult=1);for(let e=t.activeEffects.length-1;e>=0;e--){const s=t.activeEffects[e];if(!s){t.activeEffects.splice(e,1);continue}s.timer--;const a=W.create(s.type);a&&a.updateEffect&&a.updateEffect(t,s),s.timer<=0&&(t.activeEffects.splice(e,1),a&&a.removeEffect&&a.removeEffect(t))}}}class kt{static findBest(t,e,s){let a=1/0,i=null,n=null;if(s.powerUps?.enabled){const o=s.powerUps.maxDistance,l=o*o,c=e.spatialGrid.query(t.x,t.y,o);for(const h of c)if(h instanceof Yt&&h.isGood){const d=u.distSq(t,h);d<a*a&&d<l&&(a=Math.sqrt(d),i=h,n=F.POWERUP)}}if(s.bigMeteor?.enabled&&e.bigMeteor){const o=s.bigMeteor.maxDistance,l=o*o,c=u.distSq(t,e.bigMeteor);c<a*a&&c<l&&(a=Math.sqrt(c),i=e.bigMeteor,n=F.POINT)}if(s.serpents?.enabled){const o=s.serpents.maxDistance||1/0,l=o*o,c=e.spatialGrid.query(t.x,t.y,o);for(const h of c)if(h instanceof G){const d=h;if(d.segments.length===0)continue;const p=d.segments[0];if(!p)continue;const m=u.distSq(t,p);m<a*a&&m<l&&(a=Math.sqrt(m),i=p,n=F.SERPENT)}}if(s.ships?.enabled){const o=s.ships.maxDistance,l=o*o,c=s.ships.excludeSelf,h=e.spatialGrid.query(t.x,t.y,o);for(const d of h)if(d instanceof X){const p=d;if(c&&p===t)continue;const m=u.distSq(t,p);m<a*a&&m<l&&(a=Math.sqrt(m),i=p,n=F.SHIP)}}if(i===null&&s.wander?.enabled&&t instanceof X){const o=t;if(!o.wanderTarget||u.dist(o,o.wanderTarget)<s.wander.minDistance){const l=s.wander.margin;o.wanderTarget={x:u.randomRange(l,e.width-l),y:u.randomRange(l,e.height-l)}}if(o.wanderTarget)return{target:o.wanderTarget,type:F.POINT}}return{target:i,type:n}}static findForShip(t,e){return this.findBest(t,e,{powerUps:{enabled:!0,maxDistance:500},bigMeteor:{enabled:!0,maxDistance:800},serpents:{enabled:!0},ships:{enabled:!0,maxDistance:1e3,excludeSelf:!0},wander:{enabled:!0,margin:100,minDistance:100}})}static findForSerpent(t,e){return this.findBest(t,e,{powerUps:{enabled:!0,maxDistance:400},ships:{enabled:!0,maxDistance:800,excludeSelf:!1}})}}var Gt=(r=>(r.TRIANGLE="TRIANGLE",r.ARROW="ARROW",r.DIAMOND="DIAMOND",r.FIGHTER="FIGHTER",r.INTERCEPTOR="INTERCEPTOR",r.SCOUT="SCOUT",r.CRUISER="CRUISER",r.BOMBER="BOMBER",r))(Gt||{}),zt=(r=>(r.SHARP="SHARP",r.ROUNDED="ROUNDED",r.ANGULAR="ANGULAR",r))(zt||{});class He{static seedCounter=0;static generate(t){const e=this.createRNG(t),s=Object.values(Gt),a=s[Math.floor(e()*s.length)],i=Object.values(zt),n=i[Math.floor(e()*i.length)],o=8+e()*6,l=4+e()*4,c=e(),h=e()>.4,d=e()>.6,p=e()>.7,m=h?.5+e()*.5:0,x=e(),b=this.generateHullPoints(a,n,o,l,c,e);return{hullType:a,style:n,length:o,width:l,noseSharpness:c,hasWings:h,hasCockpit:d,hasAntenna:p,wingSize:m,detailLevel:x,points:b}}static createRNG(t){t===void 0&&(t=Date.now()+this.seedCounter++);let e=t;return()=>(e=(e*9301+49297)%233280,e/233280)}static generateHullPoints(t,e,s,a,i,n){const o=[];switch(t){case"TRIANGLE":o.push({x:s,y:0}),o.push({x:-s*.4,y:a}),o.push({x:-s*.2,y:0}),o.push({x:-s*.4,y:-a});break;case"ARROW":const l=s*(.7+i*.3);o.push({x:l,y:0}),o.push({x:-s*.3,y:a*.8}),o.push({x:-s*.5,y:0}),o.push({x:-s*.3,y:-a*.8});break;case"DIAMOND":o.push({x:s*.6,y:0}),o.push({x:0,y:a}),o.push({x:-s*.6,y:0}),o.push({x:0,y:-a});break;case"FIGHTER":o.push({x:s,y:0}),o.push({x:-s*.2,y:a*1.2}),o.push({x:-s*.4,y:a*.3}),o.push({x:-s*.3,y:0}),o.push({x:-s*.4,y:-a*.3}),o.push({x:-s*.2,y:-a*1.2});break;case"INTERCEPTOR":o.push({x:s*1.2,y:0}),o.push({x:-s*.3,y:a*.6}),o.push({x:-s*.1,y:0}),o.push({x:-s*.3,y:-a*.6});break;case"SCOUT":o.push({x:s*.8,y:0}),o.push({x:-s*.3,y:a*.7}),o.push({x:-s*.2,y:0}),o.push({x:-s*.3,y:-a*.7});break;case"CRUISER":o.push({x:s*.9,y:0}),o.push({x:-s*.1,y:a*1.3}),o.push({x:-s*.3,y:a*.5}),o.push({x:-s*.4,y:0}),o.push({x:-s*.3,y:-a*.5}),o.push({x:-s*.1,y:-a*1.3});break;case"BOMBER":o.push({x:s*.7,y:0}),o.push({x:0,y:a*1.1}),o.push({x:-s*.4,y:a*.8}),o.push({x:-s*.5,y:0}),o.push({x:-s*.4,y:-a*.8}),o.push({x:0,y:-a*1.1});break}return o}static getRandomHullType(){const t=Object.values(Gt);return t[Math.floor(Math.random()*t.length)]}static getRandomStyle(){const t=Object.values(zt);return t[Math.floor(Math.random()*t.length)]}}class gt{static handleShipDeath(t,e){T.createExplosion(t.x,t.y,50,t.color,e),t.markedForDeletion=!0}static handleSerpentDeath(t,e){T.createExplosion(t.x,t.y,60,"#ffffff",e);const s=t.bounty;T.addCoins(s,t.x,t.y,e),T.addDarkMatter(s,t.x,t.y,e),t.markedForDeletion=!0}static handleBigMeteorDeath(t,e){T.createExplosion(t.x,t.y,50,t.color,e),t.markedForDeletion=!0,e.spawnManager.spawnBigMeteor(e)}static handleDeath(t,e){t instanceof X?this.handleShipDeath(t,e):t instanceof G&&this.handleSerpentDeath(t,e)}}class ue{static updateShipAI(t,e){const s=e.blackHole,a=u.distSq(t,s),i=u.angle(t,s),{target:n,type:o}=kt.findForShip(t,e),l=n?{x:n.x,y:n.y}:null;let c=t.angle,h=.4,d=j.ROAM;const p=180+s.mass/w.CRITICAL_MASS*200,m=p*p;if(s.state!==k.EXPLODING&&a<m)d=j.PANIC,c=u.angle(s,t),h=1;else if(n){const x=u.distSq(t,n),b=Math.sqrt(x),E=u.angle(t,n),P=Math.abs(u.normalizeAngle(E-i));if(a<x&&P<.8&&s.state!==k.EXPLODING){const f=u.normalizeAngle(i-t.angle)>0?-1:1;c=i+Math.PI/2*f,d=j.ROAM}else{const f=e.bigMeteor&&n===e.bigMeteor;X.canAttack(o)||f?(d=j.DOGFIGHT,h=b>400?.7:.5,c=t.combatManeuverAngle(n,b)):(d=j.ROAM,c=he.getPathToTarget(t,n,s),h=.4)}}return{desiredAngle:c,engineThrust:h,state:d,target:l,targetType:o}}static updateSerpentAI(t,e){const s=e.blackHole,a=u.distSq(t,s),i=kt.findForSerpent(t,e),n=i.target?{x:i.target.x,y:i.target.y}:null,o=i.type===F.SHIP||i.type===F.POWERUP?i.type:null;let l=t.angle,c=2*t.speedMult;if(i.target){const h=u.angle(t,i.target);let d=u.normalizeAngle(h-t.angle);l=t.angle+Math.sign(d)*Math.min(Math.abs(d),.05),c=3*t.speedMult}else if(a>400*400){const h=u.angle(t,s);let d=u.normalizeAngle(h-t.angle);l=t.angle+Math.sign(d)*Math.min(Math.abs(d),.02)}return{angle:l,speed:c,target:n,targetType:o}}}class mt{static applyShipMovement(t,e,s,a){t.cooldown--,t.bombCooldown--;let i=u.normalizeAngle(e-t.angle);const n=t.state===j.DOGFIGHT?w.SHIP_TURN_SPEED*2:w.SHIP_TURN_SPEED;t.angle+=Math.sign(i)*Math.min(Math.abs(i),n),t.vx+=Math.cos(t.angle)*s,t.vy+=Math.sin(t.angle)*s,t.vx*=.96,t.vy*=.96;const o=Math.hypot(t.vx,t.vy),l=(t.state===j.PANIC?w.SHIP_SPEED*2:w.SHIP_SPEED)*t.speedMult;o>l&&(t.vx=t.vx/o*l,t.vy=t.vy/o*l),t.thrustPower=s;const c=a.warpFactor>1.1?a.warpFactor*.7:1;t.x+=t.vx*c,t.y+=t.vy*c;const h=30;t.x<-h?t.x=a.width+h:t.x>a.width+h&&(t.x=-h),t.y<-h?t.y=a.height+h:t.y>a.height+h&&(t.y=-h)}static applySerpentMovement(t,e,s,a){if(t.angle=e,a.bigMeteor){const i=a.bigMeteor.size+150,n=i*i,o=u.distSq(t,a.bigMeteor);if(o<n&&o>0){const l=Math.sqrt(o),c=u.angle(a.bigMeteor,t),h=(1-l/i)*1.5,d=Math.cos(c)*h,p=Math.sin(c)*h,m=Math.atan2(Math.sin(t.angle)*s+p,Math.cos(t.angle)*s+d);t.angle=m}}t.speed=s,t.x+=Math.cos(t.angle)*t.speed,t.y+=Math.sin(t.angle)*t.speed}static updateSerpentSegments(t,e){const s=Math.sin(Date.now()*.005+t.wobbleOffset)*(3*t.sizeMult),a=t.x+Math.cos(t.angle+Math.PI/2)*s,i=t.y+Math.sin(t.angle+Math.PI/2)*s;t.segments.unshift({x:a,y:i});const n=Math.min(w.MAX_SERPENT_SEGMENTS*t.sizeMult,80);t.segments.length>n&&t.segments.pop()}static applyShipAvoidance(t,e){const s=he.getAvoidanceVector(t,e.ships.getAll(),w.SHIP_SEPARATION);t.vx+=s.x*.5,t.vy+=s.y*.5}static applyShipBigMeteorAvoidance(t,e){if(e.bigMeteor){const s=e.bigMeteor.size+100,a=s*s,i=u.distSq(t,e.bigMeteor);if(i<a&&i>0){const n=Math.sqrt(i),o=u.angle(e.bigMeteor,t),l=(1-n/s)*2;t.vx+=Math.cos(o)*l,t.vy+=Math.sin(o)*l}}}}class Ht{static updateShipCombat(t,e,s,a,i){const n=s*s;if(i.bigMeteor&&e===i.bigMeteor){const x=e.vx||0,b=e.vy||0,E=e.x+x*15,P=e.y+b*15,S=u.angle(t,{x:E,y:P}),f=Math.abs(u.normalizeAngle(S-t.angle));if(t.weapon.isReady&&!t.isJammed){const M=t.weapon.getAllowedAngle(),D=t.weapon.getRange(w.SHIP_ENGAGEMENT_DIST),z=D*D;if(n<z&&f<M){const A=Pt.calculateCritDamage(t.damageMult);t.weapon.fire(i,t,S,A.damage,t.reloadMult)}}if(t.bombLevel>0&&t.bombCooldown<=0){const M=u.angle(t,e),D=Math.abs(u.normalizeAngle(M-t.angle));n<600*600&&D<.8&&(T.spawnBomb(t.x,t.y,t.vx,t.vy,M,t.bombLevel,i),t.bombCooldown=400)}return}const l=e.vx||0,c=e.vy||0,h=e.x+l*15,d=e.y+c*15,p=u.angle(t,{x:h,y:d}),m=Math.abs(u.normalizeAngle(p-t.angle));if(t.weapon.isReady&&!t.isJammed){const x=t.weapon.getAllowedAngle(),b=t.weapon.getRange(w.SHIP_ENGAGEMENT_DIST),E=b*b;if(n<E&&m<x){const P=Pt.calculateCritDamage(t.damageMult);t.weapon.fire(i,t,p,P.damage,t.reloadMult)}}if(t.bombLevel>0&&t.bombCooldown<=0){const x=W.create("UPGRADE_BOMB");x&&x.tryFireBomb(t,i)}}static trySerpentAttack(t,e,s,a){const i=30*t.sizeMult*(30*t.sizeMult),n=u.distSq(t,e);return G.canAttack(s)&&n<i?(J.applyDamageToShip(e,2*t.damageMult,a),t.angle+=Math.PI,!0):!1}static trySerpentPowerUpPickup(t,e,s){const a=30*t.sizeMult*(30*t.sizeMult);if(u.distSq(t,e)<a){if(e.type==="COIN"){v.darkMatter+=500,T.createExplosion(t.x,t.y,20,"#fbbf24",s);const n=ht.create(t.x,t.y,500);n.text="+500âš«",n.color="#8b5cf6",s.floatingTexts.add(n)}else t.applyPowerUp(e,s),T.createExplosion(t.x,t.y,10,e.color,s);return e.markedForDeletion=!0,!0}return!1}}class X extends V{static canAttack(t){return t===F.SERPENT||t===F.SHIP||t===F.BIG_METEOR}visualConfig;angle;cooldown=0;bombCooldown=0;thrustPower=0;hp=5;maxHp=5;state=j.ROAM;navTarget=null;targetType=null;wanderTarget=null;combatTimer=0;combatManeuver=dt.FLANK;activeEffects=[];statusIcons=[];weapon;weaponTimer=0;shield=0;maxShield=5;hasTeleport=!1;bombLevel=1;rangeMult=1;sizeMult=1;regenTimer=0;speedMult=1;damageMult=1;reloadMult=1;isJammed=!1;constructor(t,e,s){super(t,e,u.randomColor()),this.angle=s,this.weapon=new Bt,this.visualConfig=He.generate(),this.maxHp=5+(ot.getHullLevel()-1)*3,this.hp=this.maxHp,this.maxShield=ot.getShieldLevel()*5,this.shield=this.maxShield,this.cooldown=u.randomRange(0,100),this.bombCooldown=u.randomRange(0,500)}applyPowerUp(t,e){W.apply(t.type,this,e)}findBestTarget(t){return kt.findForShip(this,t)}update(t){if(this.speedMult=1,this.damageMult=ot.getDamageMultiplier(),this.reloadMult=ot.getReloadMultiplier(),this.isJammed=!1,de.updateEffects(this),this.sizeMult<1&&(this.speedMult*=1.3),this.sizeMult>1&&(this.speedMult*=.8),this.weaponTimer>0&&(this.weaponTimer--,this.weaponTimer<=0&&(this.weapon=new Bt)),this.weapon.update(),this.hasTeleport){const h=W.create("GET_TELEPORT");h&&h.tryTeleport(this,t)}const e=t.blackHole;if(u.distSq(this,e),u.angle(this,e),ct.shouldDieFromShockwave(this,e)){gt.handleShipDeath(this,t);return}if(ct.shouldDieFromGravity(this,e)){e.mass+=w.MASS_GAIN_SHIP,gt.handleShipDeath(this,t);return}const s=ct.calculateGravityPull(this,e);s&&(this.vx+=s.vx,this.vy+=s.vy);const a=ue.updateShipAI(this,t);this.state=a.state,this.navTarget=a.target,this.targetType=a.targetType;const i=a.desiredAngle,n=a.engineThrust;if(a.target&&(X.canAttack(a.targetType)||t.bigMeteor&&a.target.x===t.bigMeteor.x&&a.target.y===t.bigMeteor.y)){const h=u.dist(this,a.target),d=a.targetType===F.SERPENT;Ht.updateShipCombat(this,a.target,h,d,t)}mt.applyShipAvoidance(this,t),mt.applyShipBigMeteorAvoidance(this,t);const o=Wt.getInstance(),l={value:this.regenTimer};o.updateRegen(this,l)&&T.createExplosion(this.x,this.y,2,"#10b981",t),this.regenTimer=l.value;const c=ot.getShieldLevel()*5;this.maxShield<c&&(this.shield+=c-this.maxShield,this.maxShield=c),mt.applyShipMovement(this,i,n,t)}combatManeuverAngle(t,e){const s=u.angle(this,t);if(this.combatTimer--,this.combatTimer<=0){this.combatTimer=u.randomRange(60,120);const a=Math.random();this.combatManeuver=a<.4?dt.CHARGE:a<.8?dt.FLANK:dt.RETREAT}return this.combatManeuver===dt.CHARGE?s:this.combatManeuver===dt.RETREAT?s+Math.PI:s+Math.PI/2}handleCombat(t,e,s,a){const i=s*s;if(t.bigMeteor&&e===t.bigMeteor){const m=e.vx||0,x=e.vy||0,b=e.x+m*15,E=e.y+x*15,P=u.angle(this,{x:b,y:E}),S=Math.abs(u.normalizeAngle(P-this.angle));if(this.weapon.isReady&&!this.isJammed){const f=this.weapon.getAllowedAngle(),M=this.weapon.getRange(w.SHIP_ENGAGEMENT_DIST),D=M*M;if(i<D&&S<f){const z=Pt.calculateCritDamage(this.damageMult);this.weapon.fire(t,this,P,z.damage,this.reloadMult)}}if(this.bombLevel>0&&this.bombCooldown<=0){const f=u.angle(this,e),M=Math.abs(u.normalizeAngle(f-this.angle));i<600*600&&M<.8&&(this.bombLevel===2?w.BOMB_DAMAGE*2:w.BOMB_DAMAGE,T.spawnBomb(this.x,this.y,this.vx,this.vy,f,this.bombLevel,t),this.bombCooldown=400)}return}const o=e.vx||0,l=e.vy||0,c=e.x+o*15,h=e.y+l*15,d=u.angle(this,{x:c,y:h}),p=Math.abs(u.normalizeAngle(d-this.angle));if(this.weapon.isReady&&!this.isJammed){const m=this.weapon.getAllowedAngle(),x=this.weapon.getRange(w.SHIP_ENGAGEMENT_DIST),b=x*x;if(i<b&&p<m){const E=Pt.calculateCritDamage(this.damageMult);this.weapon.fire(t,this,d,E.damage,this.reloadMult)}}if(this.bombLevel>0&&this.bombCooldown<=0){const m=W.create("UPGRADE_BOMB");m&&m.tryFireBomb(this,t)}}takeDamage(t,e=1){J.applyDamageToShip(this,e,t)}}class J{static applyDamageToShip(t,e,s){T.spawnDamageText(t.x,t.y,e,!1,s),t.shield>0?(t.shield-=e,T.createExplosion(t.x,t.y,5,w.COLORS.shield,s),t.shield<0&&(t.hp+=t.shield,t.shield=0)):(t.hp-=e,T.createExplosion(t.x,t.y,10,t.color,s)),t.hp<=0&&gt.handleShipDeath(t,s)}static applyDamageToSerpent(t,e,s){const a=t.sizeMult>1.5?e*.7:e;t.hp-=a,T.spawnDamageText(t.x,t.y,a,a>5,s),T.createExplosion(t.x,t.y,5,t.color,s),t.hp<=0&&gt.handleSerpentDeath(t,s)}static applyDamageToBigMeteor(t,e,s){t.hp-=e,T.spawnDamageText(t.x,t.y,e,!1,s),T.createExplosion(t.x,t.y,10,t.color,s),t.hp<=0&&gt.handleBigMeteorDeath(t,s)}static applyDamage(t,e,s){t instanceof X?this.applyDamageToShip(t,e,s):t instanceof G&&this.applyDamageToSerpent(t,e,s)}}class T{static createExplosion(t,e,s,a,i){if(i.particles.count>300)return;const n=Math.floor(s*.5);for(let o=0;o<n;o++){const l=Math.random()*Math.PI*2,c=u.randomRange(2,12),h=i.particlePool.acquire(t,e,a,u.randomRange(2,6),Math.cos(l)*c,Math.sin(l)*c);i.particles.add(h)}}static spawnDamageText(t,e,s,a,i){const n=jt.create(t,e,s,a);i.floatingTexts.add(n)}static addCoins(t,e,s,a){v.coins+=t;const i=ht.create(e,s,t);a.floatingTexts.add(i)}static addDarkMatter(t,e,s,a){v.darkMatter+=t;const i=ht.create(e,s,t);i.text=`+${t}âš«`,i.color="#8b5cf6",a.floatingTexts.add(i)}static spawnBomb(t,e,s,a,i,n,o){const l=w.BOMB_DAMAGE+(n-1)*10,c=o.projectilePool.acquireBomb(t+Math.cos(i)*10,e+Math.sin(i)*10,s+Math.cos(i)*6,a+Math.sin(i)*6,l);o.projectiles.add(c)}static spawnShockwave(t,e,s){s.shockwaves.add(new Oe(t,e));const a=Le.applyAoeDamage(t,e,250,10,s.serpents.getAll());for(const{serpent:i,damage:n,pushAngle:o}of a)J.applyDamageToSerpent(i,n,s),i.x+=Math.cos(o)*20,i.y+=Math.sin(o)*20}}class Ne extends U{type="HEAL";duration=0;icon="â¤ï¸";weight=7;isGood=!0;apply(t,e){if(t.hp!==void 0&&t.maxHp!==void 0){const s=t instanceof G?10:2;t.hp=Math.min(t.hp+s,t.maxHp),T.createExplosion(t.x,t.y,10,"#10b981",e)}}}class Fe extends U{type="SPEED_BOOST";duration=w.POWERUP_DURATION;icon="âš¡";weight=8;isGood=!0;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#10b981",e))}updateEffect(t,e){t.speedMult!==void 0&&(t.speedMult=1.8)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1)}}class $e extends U{type="DAMAGE_BOOST";duration=w.POWERUP_DURATION;icon="âš”ï¸";weight=7;isGood=!0;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#f43f5e",e))}updateEffect(t,e){if(t.damageMult!==void 0){const s="segments"in t;t.damageMult=s?2:3}}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1)}}class Ue extends U{type="RAPID_FIRE";duration=w.POWERUP_DURATION;icon="ðŸ”¥";weight=0;isGood=!0;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#f59e0b",e))}updateEffect(t,e){t.reloadMult!==void 0&&(t.reloadMult=4)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1)}}class qe extends U{type="SLOW_DOWN";duration=w.POWERUP_DURATION;icon="â„ï¸";weight=6;isGood=!1;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#a855f7",e))}updateEffect(t,e){t.speedMult!==void 0&&(t.speedMult=.5)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1)}}class je extends U{type="WEAPON_JAM";duration=w.POWERUP_DURATION;icon="ðŸš«";weight=2;isGood=!1;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#a855f7",e))}updateEffect(t,e){t.isJammed!==void 0&&(t.isJammed=!0)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1)}}class We extends U{type="SIZE_UP";duration=600;icon="âž•";weight=5;isGood=!0;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#10b981",e))}updateEffect(t,e){t.sizeMult!==void 0&&(t.sizeMult=w.SIZE_MODIFIER_BIG)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1),t.sizeMult!==void 0&&(t.sizeMult=1)}}class Xe extends U{type="SIZE_DOWN";duration=600;icon="âž–";weight=5;isGood=!0;apply(t,e){const s=t.activeEffects.find(a=>a.type===this.type);s?s.timer=this.duration:(t.activeEffects.push({type:this.type,timer:this.duration}),t.statusIcons.includes(this.icon)||t.statusIcons.push(this.icon),T.createExplosion(t.x,t.y,15,t.color||"#10b981",e))}updateEffect(t,e){t.sizeMult!==void 0&&(t.sizeMult=w.SIZE_MODIFIER_SMALL)}removeEffect(t){const e=t.statusIcons.indexOf(this.icon);e>-1&&t.statusIcons.splice(e,1),t.sizeMult!==void 0&&(t.sizeMult=1)}}class Ye extends U{type="GET_SHIELD";duration=0;icon="ðŸ›¡ï¸";weight=5;isGood=!0;apply(t,e){t.shield!==void 0&&t.maxShield!==void 0&&(t.shield=t.maxShield,T.createExplosion(t.x,t.y,15,w.COLORS.shield,e))}}class Ve extends U{type="GET_TELEPORT";duration=0;icon="ðŸŒ€";weight=5;isGood=!0;apply(t,e){t.hasTeleport!==void 0&&(t.hasTeleport=!0,T.createExplosion(t.x,t.y,15,w.COLORS.shield,e))}tryTeleport(t,e){if(!t.hasTeleport||t.state!==j.DOGFIGHT||!t.navTarget)return!1;if(u.dist(t,t.navTarget)>400){const a=u.angle(t,t.navTarget);return t.x=t.navTarget.x-Math.cos(a)*100,t.y=t.navTarget.y-Math.sin(a)*100,T.createExplosion(t.x,t.y,20,w.COLORS.shield,e),t.hasTeleport=!1,!0}return!1}}class Z{static checkCircleCollision(t,e,s,a){const i=u.distSq(t,e),n=s+a;return i<n*n}static checkPointInCircle(t,e,s){return u.distSq(t,e)<s*s}static checkSegmentCollision(t,e,s,a){for(const i of e)if(this.checkCircleCollision(t,i,a,s))return!0;return!1}static checkShipCollision(t,e,s,a){const i=s*(e.sizeMult||1);return this.checkCircleCollision(t,e,a,i)}}class fe extends Ct{constructor(t,e,s,a,i){super(t,e,s,a,w.COLORS.bomb,i,4,300)}update(t){const e=t.blackHole;if(e.state!==k.EXPLODING){const n=ct.calculateGravityPull(this,e);n&&(this.vx+=n.vx*2.67,this.vy+=n.vy*2.67)}this.x+=this.vx*t.warpFactor,this.y+=this.vy*t.warpFactor,this.life--;const s=u.distSq(this,e),a=e.visualRadius*e.visualRadius;if(s<a&&e.state!==k.EXPLODING){T.createExplosion(this.x,this.y,30,this.color,t),e.mass=Math.max(0,e.mass-this.damage),e.shake=10,T.spawnShockwave(this.x,this.y,t),this.markedForDeletion=!0;return}if(t.bigMeteor&&Z.checkCircleCollision(this,t.bigMeteor,4,t.bigMeteor.size)){t.bigMeteor.hp-=1,T.createExplosion(this.x,this.y,25,this.color,t),this.markedForDeletion=!0;return}const i=t.spatialGrid.query(this.x,this.y,50);for(const n of i)if(n instanceof G){const o=n;if(Z.checkSegmentCollision(this,o.segments,30,0)){J.applyDamageToSerpent(o,100,t),T.createExplosion(this.x,this.y,40,this.color,t),T.spawnShockwave(this.x,this.y,t),this.markedForDeletion=!0;return}}this.life<=0&&(this.markedForDeletion=!0)}drawSpecific(t){t.save(),K(t,{color:this.color,intensity:1,blur:25}),t.beginPath(),t.arc(0,0,4,0,Math.PI*2),t.fillStyle=this.color,t.fill(),t.restore()}}class Ke extends U{type="UPGRADE_BOMB";duration=0;icon="ðŸ’£";weight=5;isGood=!0;apply(t,e){t.bombLevel!==void 0&&(t.bombLevel=2,T.createExplosion(t.x,t.y,15,w.COLORS.bomb,e))}tryFireBomb(t,e){if(t.bombLevel===void 0||t.bombLevel<1||t.bombCooldown>0)return!1;const s=e.blackHole,a=u.angle(t,s),i=Math.abs(u.normalizeAngle(a-t.angle)),n=u.dist(t,s);return i<.5&&n<500&&s.state!==k.EXPLODING?(t.bombLevel===2?w.BOMB_DAMAGE*2:w.BOMB_DAMAGE,T.spawnBomb(t.x,t.y,t.vx,t.vy,t.angle,t.bombLevel,e),t.bombCooldown=400,!0):!1}}class Je extends U{type="UPGRADE_RANGE";duration=0;icon="ðŸ”­";weight=5;isGood=!0;apply(t,e){t.rangeMult!==void 0&&(t.rangeMult=1.5,T.createExplosion(t.x,t.y,15,t.color||"#10b981",e))}}class Ze extends tt{config={cooldown:5,damage:.3,speed:14,spread:.3,color:"#f59e0b",size:1.5};icon="âˆ´";duration=400;getAllowedAngle(){return .8}spawnProjectiles(t,e,s,a){const i=(Math.random()-.5)*this.config.spread,n=e.vx+Math.cos(s+i)*this.config.speed,o=e.vy+Math.sin(s+i)*this.config.speed,l=t.projectilePool.acquireLinear(e.x,e.y,n,o,this.config.color,this.config.damage*a,this.config.size,50);t.projectiles.add(l)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save(),a.strokeStyle="#f59e0b",a.shadowColor="#f59e0b",a.shadowBlur=20,a.lineWidth=1.5;for(let i=0;i<3;i++)a.beginPath(),a.moveTo(t/2,e/2),a.lineTo(t/2-15-i*2,e/2+(Math.random()-.5)*4),a.stroke();return a.restore(),{canvas:s,width:t,height:e,key:"minigun"}}}class Qe extends tt{config={cooldown:60,damage:.8,speed:10,spread:.4,color:"#ef4444",size:2,count:5};icon="â‹—";duration=500;spawnProjectiles(t,e,s,a){const i=this.config.count||5;for(let n=0;n<i;n++){const o=(Math.random()-.5)*this.config.spread,l=e.vx+Math.cos(s+o)*this.config.speed,c=e.vy+Math.sin(s+o)*this.config.speed,h=t.projectilePool.acquireLinear(e.x,e.y,l,c,this.config.color,this.config.damage*a,this.config.size,40);t.projectiles.add(h)}}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save(),a.strokeStyle="#ef4444",a.shadowColor="#ef4444",a.shadowBlur=18,a.lineWidth=2;const i=t/2,n=e/2;for(let o=0;o<5;o++){const l=-.4+o*.2;a.beginPath(),a.moveTo(i,n),a.lineTo(i+Math.cos(l)*18,n+Math.sin(l)*18),a.stroke()}return a.restore(),{canvas:s,width:t,height:e,key:"shotgun"}}}class ts extends tt{config={cooldown:100,damage:10,speed:40,spread:0,color:"#06b6d4",size:4};icon="â”";duration=800;spawnProjectiles(t,e,s,a){const i=e.vx+Math.cos(s)*this.config.speed,n=e.vy+Math.sin(s)*this.config.speed,o=t.projectilePool.acquireLinear(e.x,e.y,i,n,this.config.color,this.config.damage*a,this.config.size,30);t.projectiles.add(o)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");return a.save(),a.strokeStyle="#06b6d4",a.shadowColor="#06b6d4",a.shadowBlur=25,a.lineWidth=4,a.beginPath(),a.moveTo(t/2,e/2),a.lineTo(t/2-30,e/2),a.stroke(),a.restore(),{canvas:s,width:t,height:e,key:"railgun"}}}class es extends tt{config={cooldown:120,damage:4,speed:5,spread:.2,color:"#ec4899",size:3};icon="ðŸš€";duration=700;getRange(t){return 1e3}spawnProjectiles(t,e,s,a){const i=(Math.random()-.5)*this.config.spread,n=e.vx+Math.cos(s+i)*this.config.speed,o=e.vy+Math.sin(s+i)*this.config.speed,l=new pe(e.x,e.y,n,o,this.config.color,this.config.damage*a);t.projectiles.add(l)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save();const i=t/2,n=e/2;return a.fillStyle="#ec4899",a.shadowColor="#ec4899",a.shadowBlur=20,a.beginPath(),a.moveTo(i+6,n),a.lineTo(i-4,n+4),a.lineTo(i-4,n-4),a.fill(),a.strokeStyle="#f59e0b",a.shadowColor="#f59e0b",a.shadowBlur=15,a.lineWidth=2,a.beginPath(),a.moveTo(i-4,n),a.lineTo(i-10,n),a.stroke(),a.restore(),{canvas:s,width:t,height:e,key:"missile"}}}class Xt extends Ct{pattern;initialV;spawnTime;constructor(t,e,s,a,i,n,o,l){super(t,e,s,a,i,n,o,60),this.pattern=l,this.initialV={x:s,y:a},this.spawnTime=Date.now(),l==="PLASMA"&&(this.life=100)}update(t){if(this.pattern==="WAVE"){const e=(Date.now()-this.spawnTime)*.015,s=-this.initialV.y,a=this.initialV.x,i=Math.sqrt(s*s+a*a)||1,n=Math.sin(e)*4;this.x+=s/i*n*.2,this.y+=a/i*n*.2}else if(this.pattern==="FLAK"&&this.life<10){for(let e=0;e<6;e++){const s=Math.random()*Math.PI*2,a=6,i=t.projectilePool.acquireLinear(this.x,this.y,Math.cos(s)*a,Math.sin(s)*a,this.color,1,1.5,20);t.projectiles.add(i)}this.markedForDeletion=!0;return}super.update(t)}shouldDeleteOnHit(){return this.pattern!=="PLASMA"}createHitEffect(t,e){this.pattern==="PLASMA"?T.createExplosion(this.x,this.y,2,this.color,t):e&&e(this.x,this.y,this.color)}drawSpecific(t){if(t.save(),this.pattern==="PLASMA"){const e=Math.sin(Date.now()*.02)*2,s=Be(1,Date.now()*.01,2);K(t,{color:this.color,intensity:s,blur:30}),t.beginPath(),t.arc(0,0,this.size+e,0,Math.PI*2),t.fillStyle=this.color,t.fill()}else this.pattern==="FLAK"?(K(t,{color:this.color,intensity:1,blur:20}),t.beginPath(),t.arc(0,0,this.size,0,Math.PI*2),t.fillStyle=this.color,t.fill()):(K(t,{color:this.color,intensity:.8,blur:15}),t.beginPath(),t.arc(0,0,this.size,0,Math.PI*2),t.fillStyle=this.color,t.fill());t.restore()}}class ss extends tt{config={cooldown:150,damage:.5,speed:3,spread:0,color:"#8b5cf6",size:8};icon="ðŸŸ£";duration=900;spawnProjectiles(t,e,s,a){const i=e.vx+Math.cos(s)*this.config.speed,n=e.vy+Math.sin(s)*this.config.speed,o=new Xt(e.x,e.y,i,n,this.config.color,this.config.damage*a,this.config.size,"PLASMA");t.projectiles.add(o)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save();const i=t/2,n=e/2,o=8,l=a.createRadialGradient(i,n,0,i,n,o);return l.addColorStop(0,"#ffffff"),l.addColorStop(.5,"#8b5cf6"),l.addColorStop(1,"transparent"),a.fillStyle=l,a.shadowColor="#8b5cf6",a.shadowBlur=30,a.beginPath(),a.arc(i,n,o,0,Math.PI*2),a.fill(),a.restore(),{canvas:s,width:t,height:e,key:"plasma"}}}class as extends tt{config={cooldown:90,damage:2,speed:9,spread:.1,color:"#64748b",size:3};icon="ðŸ’¥";duration=550;spawnProjectiles(t,e,s,a){const i=(Math.random()-.5)*this.config.spread,n=e.vx+Math.cos(s+i)*this.config.speed,o=e.vy+Math.sin(s+i)*this.config.speed,l=new Xt(e.x,e.y,n,o,this.config.color,this.config.damage*a,this.config.size,"FLAK");t.projectiles.add(l)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save();const i=t/2,n=e/2;a.fillStyle="#64748b",a.shadowColor="#64748b",a.shadowBlur=22,a.beginPath(),a.arc(i,n,3,0,Math.PI*2),a.fill();for(let o=0;o<6;o++){const l=Math.PI*2*o/6;a.beginPath(),a.moveTo(i,n),a.lineTo(i+Math.cos(l)*5,n+Math.sin(l)*5),a.stroke()}return a.restore(),{canvas:s,width:t,height:e,key:"flak"}}}class is extends tt{config={cooldown:25,damage:1.5,speed:7,spread:0,color:"#14b8a6",size:2};icon="ã€°ï¸";duration=450;spawnProjectiles(t,e,s,a){const i=e.vx+Math.cos(s)*this.config.speed,n=e.vy+Math.sin(s)*this.config.speed,o=new Xt(e.x,e.y,i,n,this.config.color,this.config.damage*a,this.config.size,"WAVE");t.projectiles.add(o)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");a.save(),a.strokeStyle="#14b8a6",a.shadowColor="#14b8a6",a.shadowBlur=18,a.lineWidth=2,a.beginPath();const i=t/2,n=e/2;for(let o=0;o<20;o++){const l=n+Math.sin(o*.5)*3;o===0?a.moveTo(i+o,l):a.lineTo(i+o,l)}return a.stroke(),a.restore(),{canvas:s,width:t,height:e,key:"wave"}}}class os extends tt{config={cooldown:180,damage:15,speed:60,spread:0,color:"#ffffff",size:2};icon="ðŸŽ¯";duration=1e3;getRange(t){return 1e3}spawnProjectiles(t,e,s,a){const i=e.vx+Math.cos(s)*this.config.speed,n=e.vy+Math.sin(s)*this.config.speed,o=t.projectilePool.acquireLinear(e.x,e.y,i,n,this.config.color,this.config.damage*a,this.config.size,30);t.projectiles.add(o)}generateVisual(t,e){const s=et.createCanvas(t,e),a=s.getContext("2d");return a.save(),a.strokeStyle="#ffffff",a.shadowColor="#ffffff",a.shadowBlur=30,a.lineWidth=2,a.beginPath(),a.moveTo(t/2,e/2),a.lineTo(t/2-40,e/2),a.stroke(),a.beginPath(),a.arc(t/2-20,e/2,2,0,Math.PI*2),a.fill(),a.restore(),{canvas:s,width:t,height:e,key:"sniper"}}}class at extends U{type;icon;weight;isGood=!0;weaponClass;constructor(t,e,s,a){super(),this.type=t,this.weaponClass=e,this.icon=s,this.weight=a}get duration(){return new this.weaponClass().duration}apply(t,e){if(t.weapon!==void 0&&t.weaponTimer!==void 0){const s=new this.weaponClass;t.weapon=s,t.weaponTimer=this.duration,T.createExplosion(t.x,t.y,15,t.color||"#10b981",e)}}}class ns extends U{type="COIN";duration=0;icon="ðŸ’°";weight=3;isGood=!0;apply(t,e){if(t instanceof X){v.coins+=500,T.createExplosion(t.x,t.y,20,"#fbbf24",e);const s=ht.create(t.x,t.y,500);e.floatingTexts.add(s)}else if(t instanceof G){v.darkMatter+=500,T.createExplosion(t.x,t.y,20,"#fbbf24",e);const s=ht.create(t.x,t.y,500);s.text="+500âš«",s.color="#8b5cf6",e.floatingTexts.add(s)}}}const _=class _{static create(t){return this.upgrades.get(t)||null}static apply(t,e,s){const a=this.create(t);a&&a.apply(e,s)}};Jt(_,"upgrades",new Map),_.upgrades.set("HEAL",new Ne),_.upgrades.set("SPEED_BOOST",new Fe),_.upgrades.set("DAMAGE_BOOST",new $e),_.upgrades.set("RAPID_FIRE",new Ue),_.upgrades.set("SLOW_DOWN",new qe),_.upgrades.set("WEAPON_JAM",new je),_.upgrades.set("SIZE_UP",new We),_.upgrades.set("SIZE_DOWN",new Xe),_.upgrades.set("GET_SHIELD",new Ye),_.upgrades.set("GET_TELEPORT",new Ve),_.upgrades.set("UPGRADE_BOMB",new Ke),_.upgrades.set("UPGRADE_RANGE",new Je),_.upgrades.set("COIN",new ns),_.upgrades.set("GET_MINIGUN",new at("GET_MINIGUN",Ze,"âˆ´",5)),_.upgrades.set("GET_SHOTGUN",new at("GET_SHOTGUN",Qe,"â‹—",5)),_.upgrades.set("GET_RAILGUN",new at("GET_RAILGUN",ts,"â”",4)),_.upgrades.set("GET_MISSILE",new at("GET_MISSILE",es,"ðŸš€",4)),_.upgrades.set("GET_PLASMA",new at("GET_PLASMA",ss,"ðŸŸ£",4)),_.upgrades.set("GET_FLAK",new at("GET_FLAK",as,"ðŸ’¥",4)),_.upgrades.set("GET_WAVE",new at("GET_WAVE",is,"ã€°ï¸",3)),_.upgrades.set("GET_SNIPER",new at("GET_SNIPER",os,"ðŸŽ¯",3));let W=_;class rs{static totalWeight=0;static initialized=!1;static upgradeList=[];static initialize(){if(this.initialized)return;const t=["SPEED_BOOST","DAMAGE_BOOST","SIZE_UP","SIZE_DOWN","GET_SHIELD","GET_TELEPORT","UPGRADE_RANGE","UPGRADE_BOMB","HEAL","COIN","GET_MINIGUN","GET_SHOTGUN","GET_RAILGUN","GET_MISSILE","GET_PLASMA","GET_FLAK","GET_WAVE","GET_SNIPER","SLOW_DOWN","WEAPON_JAM"];this.upgradeList=[];for(const e of t){const s=W.create(e);s&&s.weight>0&&this.upgradeList.push(s)}this.totalWeight=this.upgradeList.reduce((e,s)=>e+s.weight,0),this.initialized=!0}static generateType(){if(this.initialize(),this.upgradeList.length===0)return{type:"HEAL",isGood:!0};const t=Math.random()*this.totalWeight;let e=0;for(const a of this.upgradeList)if(e+=a.weight,t<e)return{type:a.type,isGood:a.isGood};const s=this.upgradeList[this.upgradeList.length-1];return s?{type:s.type,isGood:s.isGood}:{type:"HEAL",isGood:!0}}}class Yt extends V{type;isGood;life=1200;pulse=0;constructor(t,e){const{type:s,isGood:a}=rs.generateType();super(t,e,a?w.COLORS.buff:w.COLORS.debuff),this.type=s,this.isGood=a,this.vx=u.randomRange(-2,2),this.vy=u.randomRange(-2,2)}update(t){this.x+=this.vx*t.warpFactor,this.y+=this.vy*t.warpFactor,this.vx*=.92,this.vy*=.92,this.pulse+=.1,this.life--,this.life<=0&&(this.markedForDeletion=!0)}}class G extends V{static canAttack(t){return t===F.SHIP}life=1;angle;speed;segments=[];wobbleOffset=Math.random()*100;hp=30;maxHp=30;activeEffects=[];statusIcons=[];sizeMult=1;navTarget=null;targetType=null;damageMult=1;speedMult=1;constructor(t,e){const s=u.randomRange(250,300);super(t,e,`hsla(${s}, 100%, 70%, 1)`),this.angle=Math.random()*Math.PI*2,this.speed=u.randomRange(1.5,2.5),this.segments.push({x:t,y:e})}applyPowerUp(t,e){if(t.type.startsWith("GET_")&&t.type!=="GET_SHIELD"&&t.type!=="GET_TELEPORT"){W.apply("DAMAGE_BOOST",this,e);return}W.apply(t.type,this,e)}get bounty(){let t=50;return this.sizeMult>1.2&&(t*=2),this.activeEffects.length>0&&(t+=25*this.activeEffects.length),Math.floor(t)}takeDamage(t,e=1){J.applyDamageToSerpent(this,e,t)}findTarget(t){const e=kt.findForSerpent(this,t);return e.target?(this.navTarget={x:e.target.x,y:e.target.y},this.targetType=e.type===F.SHIP||e.type===F.POWERUP?e.type:null,e.target):(this.navTarget=null,this.targetType=null,null)}update(t){const e=t.blackHole,s=u.distSq(this,e);if(ct.shouldDieFromShockwave(this,e)){this.takeDamage(t,9999);return}de.updateEffects(this);const a=ue.updateSerpentAI(this,t);if(this.navTarget=a.target,this.targetType=a.targetType,a.target){const i=this.findTarget(t);i&&(G.canAttack(a.targetType)&&Ht.trySerpentAttack(this,i,a.targetType,t),a.targetType===F.POWERUP&&i instanceof Yt&&Ht.trySerpentPowerUpPickup(this,i,t))}mt.applySerpentMovement(this,a.angle,a.speed,t),mt.updateSerpentSegments(this,t),s>900*900&&(this.life-=.01),this.life<=0&&(this.markedForDeletion=!0)}}class ls extends V{life=1;size;constructor(t,e,s,a,i,n){super(t,e,s),this.size=a,this.vx=i,this.vy=n}update(){this.x+=this.vx,this.y+=this.vy,this.life-=.02,this.life<=0&&(this.markedForDeletion=!0)}}class pe extends Ct{target;trail=[];fuel=100;constructor(t,e,s,a,i,n){super(t,e,s,a,i,n,4,200)}update(t){if(!this.target||this.target instanceof V&&this.target.markedForDeletion){let e=1/0;const s=t.spatialGrid.query(this.x,this.y,800),a=800*800;for(const i of s)if(i instanceof X){const n=i;if(n.color===this.color)continue;const o=u.distSq(this,n);o<e*e&&o<a&&(e=Math.sqrt(o),this.target=n)}else if(i instanceof G&&!this.target){const n=i,o=u.distSq(this,n);o<e*e&&o<a&&(e=Math.sqrt(o),this.target=n)}}if(this.target&&this.fuel>0){const e=this.target instanceof G&&this.target.segments.length>0&&this.target.segments[0]?this.target.segments[0].x:this.target.x,s=this.target instanceof G&&this.target.segments.length>0&&this.target.segments[0]?this.target.segments[0].y:this.target.y,a=Math.atan2(s-this.y,e-this.x),i=Math.atan2(this.vy,this.vx);let n=u.normalizeAngle(a-i);const o=.08*t.warpFactor,l=i+Math.sign(n)*Math.min(Math.abs(n),o),c=Math.hypot(this.vx,this.vy);this.vx=Math.cos(l)*c*1.02,this.vy=Math.sin(l)*c*1.02;const h=12,d=Math.hypot(this.vx,this.vy);if(d>h&&(this.vx=this.vx/d*h,this.vy=this.vy/d*h),this.fuel--,Math.random()<.4){const p=t.particlePool.acquire(this.x,this.y,"#555",u.randomRange(1,3),0,0);t.particles.add(p)}}this.trail.push({x:this.x,y:this.y}),this.trail.length>w.MAX_MISSILE_TRAIL&&this.trail.shift(),super.update(t)}createHitEffect(t,e){T.createExplosion(this.x,this.y,20,"#fbbf24",t),T.spawnShockwave(this.x,this.y,t),this.markedForDeletion=!0}drawSpecific(t){if(t.rotate(-Math.atan2(this.vy,this.vx)),this.trail.length>1&&this.trail[0]){t.save(),t.strokeStyle="#9ca3af",t.shadowColor="#9ca3af",t.shadowBlur=8,t.lineWidth=1,t.beginPath(),t.moveTo(this.trail[0].x-this.x,this.trail[0].y-this.y);for(const e of this.trail)e&&t.lineTo(e.x-this.x,e.y-this.y);t.stroke(),t.restore()}t.rotate(Math.atan2(this.vy,this.vx)),t.save(),t.fillStyle=this.color,t.shadowColor=this.color,t.shadowBlur=20,t.beginPath(),t.moveTo(6,0),t.lineTo(-4,4),t.lineTo(-4,-4),t.fill(),t.restore(),t.save(),t.strokeStyle="#f59e0b",t.shadowColor="#f59e0b",t.shadowBlur=15,t.lineWidth=2,t.beginPath(),t.moveTo(-4,0),t.lineTo(-8,0),t.stroke(),t.restore()}}class cs{layers=[];constructor(){this.layers=[{baseX:.3,baseY:.4,baseRadius:.6,color:"#4c1d95",speedX:1e-4,speedY:8e-5,pulseSpeed:5e-4,intensitySpeed:8e-4},{baseX:.7,baseY:.6,baseRadius:.5,color:"#6d28d9",speedX:-12e-5,speedY:1e-4,pulseSpeed:6e-4,intensitySpeed:7e-4},{baseX:.5,baseY:.3,baseRadius:.4,color:"#1e3a8a",speedX:8e-5,speedY:-1e-4,pulseSpeed:4e-4,intensitySpeed:9e-4},{baseX:.2,baseY:.7,baseRadius:.45,color:"#312e81",speedX:-1e-4,speedY:-8e-5,pulseSpeed:55e-5,intensitySpeed:6e-4},{baseX:.8,baseY:.2,baseRadius:.35,color:"#3b82f6",speedX:9e-5,speedY:12e-5,pulseSpeed:45e-5,intensitySpeed:85e-5}]}draw(t,e,s,a){t.save();for(const i of this.layers){const n=(i.baseX+Math.sin(a*i.speedX)*.2)*e,o=(i.baseY+Math.cos(a*i.speedY)*.2)*s,l=Math.sin(a*i.pulseSpeed)*.1+1,c=i.baseRadius*Math.max(e,s)*l,h=(Math.sin(a*i.intensitySpeed)*.2+.8)*.5,d=t.createRadialGradient(n,o,0,n,o,c),p=this.hexToRgba(i.color,h);d.addColorStop(0,p),d.addColorStop(.5,this.hexToRgba(i.color,h*.7)),d.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=d,t.fillRect(0,0,e,s)}t.restore()}hexToRgba(t,e){const s=parseInt(t.slice(1,3),16),a=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16);return`rgba(${s}, ${a}, ${i}, ${e})`}}class hs{ctx;nebulaBackground;constructor(t){this.ctx=t,this.nebulaBackground=new cs}drawNebula(t,e,s,a,i){a&&i<100||this.nebulaBackground.draw(this.ctx,t,e,s)}clear(t,e,s,a,i){if(a){if(i<100){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,t,e);return}this.ctx.fillStyle=w.COLORS.bg,this.ctx.fillRect(0,0,t,e)}else this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,t,e)}applyTrailEffect(t,e,s){const a=.15+1/s*.25;this.ctx.fillStyle=`rgba(10, 10, 10, ${a})`,this.ctx.fillRect(0,0,t,e)}drawBlackHole(t){if(t.state===k.EXPLODING){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.shockwaveRadius,0,Math.PI*2),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=15,this.ctx.globalAlpha=Math.max(0,1-t.shockwaveRadius/2e3),this.ctx.stroke(),this.ctx.globalAlpha=1;return}const e=t.safetyTimer>0?.5:1,s=this.ctx.createRadialGradient(t.x,t.y,t.visualRadius*.8,t.x,t.y,t.visualRadius*2.5),a=t.state===k.UNSTABLE?w.COLORS.danger:w.COLORS.primary;s.addColorStop(0,a),s.addColorStop(1,"rgba(0,0,0,0)"),this.ctx.globalAlpha=e*.6,this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.visualRadius*3,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1*e,this.drawAccretionDisk(t),this.drawBlackHoleCore(t)}drawBlackHoleCore(t){if(this.ctx.save(),this.ctx.translate(t.x,t.y),t.shake>0){const i=t.shake*.5;this.ctx.translate(u.randomRange(-i,i),u.randomRange(-i,i))}const e=t.visualRadius,s=t.state===k.UNSTABLE?"#ef4444":"#8b5cf6";this.ctx.beginPath(),this.ctx.arc(0,0,e,0,Math.PI*2),this.ctx.fillStyle="#000000",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(0,0,e*.95,0,Math.PI*2),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.shadowBlur=10,this.ctx.shadowColor=s,this.ctx.stroke(),this.ctx.shadowBlur=0;const a=this.ctx.createRadialGradient(0,0,0,0,0,e*.9);a.addColorStop(0,"#000000"),a.addColorStop(.6,"rgba(0,0,0,0.8)"),a.addColorStop(1,s),this.ctx.globalAlpha=.3,this.ctx.fillStyle=a,this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.restore()}drawAccretionDisk(t){if(this.ctx.save(),this.ctx.translate(t.x,t.y),t.shake>0){const a=t.shake*.5;this.ctx.translate(u.randomRange(-a,a),u.randomRange(-a,a))}this.ctx.rotate(Date.now()*2e-4);const e=t.upgrades,s=[];for(let a=0;a<e.serpentBaseCost;a++)s.push({type:"serpentBaseCost",color:"#d4a017"});for(let a=0;a<e.serpentHealth;a++)s.push({type:"serpentHealth",color:"#0d8f5e"});for(let a=0;a<e.serpentSpeed;a++)s.push({type:"serpentSpeed",color:"#2d5aa0"});for(let a=0;a<e.serpentDamage;a++)s.push({type:"serpentDamage",color:"#c53030"});for(let a=0;a<e.balanceRate;a++)s.push({type:"balanceRate",color:"#6d28d9"});if(s.length>0){const a=t.visualRadius+25,i=Date.now()*.001,n=3,o=15;for(let l=0;l<n;l++){const c=a+l*o;this.ctx.beginPath(),this.ctx.arc(0,0,c,0,Math.PI*2),this.ctx.strokeStyle="rgba(255, 255, 255, 0.15)",this.ctx.lineWidth=1,this.ctx.stroke()}s.forEach((l,c)=>{const h=Math.PI*2*c/s.length+i*.3,d=a+c%n*o;this.ctx.beginPath(),this.ctx.arc(Math.cos(h)*d,Math.sin(h)*d,5,0,Math.PI*2),this.ctx.fillStyle=l.color,this.ctx.globalAlpha=.7,this.ctx.shadowBlur=6,this.ctx.shadowColor=l.color,this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1})}this.ctx.restore()}drawMeteor(t,e){if(t.trail.length>1){const s=t.trail[0];if(s){this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y);for(const a of t.trail)a&&this.ctx.lineTo(a.x,a.y);this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.isDebris?2:1.5,this.ctx.globalAlpha=t.isDebris?.8:.4,this.ctx.stroke(),this.ctx.globalAlpha=1}}this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fillStyle=t.color,t.gravityFactor<0&&(this.ctx.shadowBlur=8,this.ctx.shadowColor=t.color),this.ctx.fill(),this.ctx.shadowBlur=0}drawMeteorsBatch(t,e){if(t.length===0)return;const s=new Map;for(const a of t){if(a.markedForDeletion)continue;const i=`${a.color}|${a.isDebris?"debris":"normal"}`;s.has(i)||s.set(i,[]),s.get(i).push(a)}for(const[a,i]of s){if(i.length===0)continue;const n=a.split("|"),o=n[0]||"#ffffff",l=n[1]==="debris";this.ctx.strokeStyle=o,this.ctx.lineWidth=l?2:1.5,this.ctx.globalAlpha=l?.8:.4;for(const c of i)if(c.trail.length>1){const h=c.trail[0];if(h){this.ctx.beginPath(),this.ctx.moveTo(h.x,h.y);for(const d of c.trail)d&&this.ctx.lineTo(d.x,d.y);this.ctx.stroke()}}this.ctx.globalAlpha=1,this.ctx.fillStyle=o,this.ctx.beginPath();for(const c of i)this.ctx.moveTo(c.x+c.size,c.y),this.ctx.arc(c.x,c.y,c.size,0,Math.PI*2);this.ctx.fill();for(const c of i)c.gravityFactor<0&&(this.ctx.shadowBlur=8,this.ctx.shadowColor=c.color,this.ctx.beginPath(),this.ctx.arc(c.x,c.y,c.size,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0)}}drawBigMeteor(t,e){if(this.ctx.save(),t.trail.length>1){const s=t.trail[0];if(s){const a=this.ctx.createLinearGradient(s.x,s.y,t.x,t.y);a.addColorStop(0,"transparent"),a.addColorStop(.5,`${t.color}80`),a.addColorStop(1,t.color),this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y);for(let i=1;i<t.trail.length;i++){const n=t.trail[i];n&&this.ctx.lineTo(n.x,n.y)}K(this.ctx,{color:t.color,blur:15,intensity:.6}),this.ctx.strokeStyle=a,this.ctx.lineWidth=3,this.ctx.globalAlpha=.6,this.ctx.stroke(),this.ctx.globalAlpha=1}}if(this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),K(this.ctx,{color:t.color,blur:20,intensity:.8}),t.visualConfig&&t.visualConfig.points.length>0){this.ctx.beginPath();const s=t.visualConfig.points[0];if(s){this.ctx.moveTo(s.x,s.y);for(const a of t.visualConfig.points)this.ctx.lineTo(a.x,a.y);this.ctx.closePath(),this.ctx.fillStyle=t.color,this.ctx.fill()}}else this.ctx.beginPath(),this.ctx.arc(0,0,t.size,0,Math.PI*2),this.ctx.fillStyle=t.color,this.ctx.fill();if(this.ctx.restore(),t.hp<t.maxHp){const s=t.size*3,a=4,i=t.size+15;this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(t.x-s/2,t.y-i,s,a);const n=Math.max(0,Math.min(1,t.hp/t.maxHp));this.ctx.fillStyle="#00ff00",this.ctx.fillRect(t.x-s/2,t.y-i,s*n,a)}}drawShip(t){if(t.navTarget&&t.state!==j.PANIC&&(this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.navTarget.x,t.navTarget.y),this.ctx.strokeStyle="rgba(255,255,255,0.1)",this.ctx.setLineDash([3,3]),this.ctx.stroke(),this.ctx.setLineDash([])),this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.scale(t.sizeMult,t.sizeMult),t.shield>0&&(this.ctx.beginPath(),this.ctx.arc(0,0,14,0,Math.PI*2),this.ctx.strokeStyle=`rgba(59, 130, 246, ${t.shield/t.maxShield})`,this.ctx.lineWidth=1,this.ctx.stroke()),t.thrustPower>.1){const l=Math.random()*.4+.8,c=t.state===j.PANIC?180:80,h=t.thrustPower*c*l*.02;this.ctx.beginPath(),this.ctx.moveTo(-6,-2),this.ctx.lineTo(-6-h*20,0),this.ctx.lineTo(-6,2),this.ctx.fillStyle=t.state===j.PANIC?"#ef4444":w.COLORS.shipEngines,this.ctx.fill()}this.ctx.save(),K(this.ctx,{color:t.color,intensity:1,blur:20}),this.ctx.fillStyle=t.color,this.ctx.beginPath();const e=t.visualConfig.points;if(e&&e.length>0){const l=e[0];if(l){this.ctx.moveTo(l.x,l.y);for(let c=1;c<e.length;c++){const h=e[c];h&&this.ctx.lineTo(h.x,h.y)}this.ctx.closePath()}}else this.ctx.moveTo(10,0),this.ctx.lineTo(-6,6),this.ctx.lineTo(-4,0),this.ctx.lineTo(-6,-6);this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke();const s=t.visualConfig;if(s.hasCockpit&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(s.length*.3,0,2,0,Math.PI*2),this.ctx.fill()),s.hasWings){const l=s.width*s.wingSize;this.ctx.strokeStyle=t.color,this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.moveTo(-s.length*.2,s.width*.5),this.ctx.lineTo(-s.length*.4,s.width*.5+l),this.ctx.lineTo(-s.length*.3,s.width*.5),this.ctx.moveTo(-s.length*.2,-s.width*.5),this.ctx.lineTo(-s.length*.4,-s.width*.5-l),this.ctx.lineTo(-s.length*.3,-s.width*.5),this.ctx.stroke()}s.hasAntenna&&(this.ctx.strokeStyle=t.color,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(s.length*.8,0),this.ctx.lineTo(s.length*.9,-1),this.ctx.stroke()),this.ctx.restore(),this.ctx.restore(),this.ctx.save(),this.ctx.translate(t.x,t.y);const a=-18*t.sizeMult,i=20;if(t.hp<t.maxHp&&(this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(-i/2,a-3,i,3),this.ctx.fillStyle="#00ff00",this.ctx.fillRect(-i/2,a-3,i*(t.hp/t.maxHp),3)),t.weapon&&t.weapon.cooldownTimer>0){const l=t.weapon.config.cooldown,c=Math.max(0,1-t.weapon.cooldownTimer/l);this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(-i/2,a+1,i,2),this.ctx.fillStyle="#fbbf24",this.ctx.fillRect(-i/2,a+1,i*c,2)}const n=a-10;this.ctx.font="10px monospace",this.ctx.textAlign="center",this.ctx.fillStyle="#ffffff";let o="";t.weapon.icon&&(o+=t.weapon.icon),o+=t.statusIcons.join(""),o&&this.ctx.fillText(o,0,n),this.ctx.restore()}drawPowerUp(t){this.ctx.save(),this.ctx.translate(t.x,t.y);const e=1+Math.sin(t.pulse)*.2;this.ctx.scale(e,e),this.ctx.shadowBlur=15,this.ctx.shadowColor=t.color,this.ctx.beginPath(),this.ctx.arc(0,0,8,0,Math.PI*2),this.ctx.strokeStyle=t.color,this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillStyle=t.color,this.ctx.font="12px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowBlur=0;const s=W.create(t.type),a=s?s.getIcon():"?";this.ctx.fillText(a,0,1),this.ctx.restore()}drawProjectile(t){this.ctx.save(),this.ctx.translate(t.x,t.y),t.drawSpecific(this.ctx),t instanceof pe&&t.fuel>0&&(this.ctx.rotate(0),this.ctx.fillStyle="#555",this.ctx.fillRect(-5,-10,10,2),this.ctx.fillStyle="#f59e0b",this.ctx.fillRect(-5,-10,10*(t.fuel/100),2)),this.ctx.restore()}drawParticle(t){const e=Math.max(0,t.size*t.life);this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2),this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life,this.ctx.fill(),this.ctx.globalAlpha=1}drawParticlesBatch(t){if(t.length===0)return;const e=new Map;for(const s of t){if(s.markedForDeletion||s.life<=0||Math.max(0,s.size*s.life)<=0)continue;const i=Math.floor(s.life*10)/10,n=`${s.color}|${i}`;e.has(n)||e.set(n,[]),e.get(n).push(s)}for(const[s,a]of e){if(a.length===0)continue;const i=s.split("|"),n=i[0]||"#ffffff",o=i[1]||"1",l=parseFloat(o);this.ctx.fillStyle=n,this.ctx.globalAlpha=l,this.ctx.beginPath();for(const c of a){const h=Math.max(0,c.size*c.life);h>0&&(this.ctx.moveTo(c.x+h,c.y),this.ctx.arc(c.x,c.y,h,0,Math.PI*2))}this.ctx.fill()}this.ctx.globalAlpha=1}drawStars(t,e){for(let s=0;s<t.length;s++){const a=t[s];if(a){if(this.ctx.beginPath(),this.ctx.arc(a.x,a.y,2,0,Math.PI*2),this.ctx.fillStyle=a.color,this.ctx.fill(),e>1.1){const i=a.x-window.innerWidth/2,n=a.y-window.innerHeight/2,o=Math.sqrt(i*i+n*n)||1;this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(a.x-i/o*20*(e-1),a.y-n/o*20*(e-1)),this.ctx.strokeStyle="rgba(139, 92, 246, 0.5)",this.ctx.lineWidth=2,this.ctx.stroke()}else if(e<1.2)for(let i=s+1;i<t.length;i++){const n=t[i];if(!n)continue;const o=u.dist(a,n);o<150&&(this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(n.x,n.y),this.ctx.strokeStyle=`rgba(139, 92, 246, ${(1-o/150)*.25})`,this.ctx.lineWidth=1,this.ctx.stroke())}}}}drawVoidSerpent(t){if(t.navTarget&&(this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.navTarget.x,t.navTarget.y),this.ctx.strokeStyle="rgba(139, 92, 246, 0.3)",this.ctx.lineWidth=1,this.ctx.setLineDash([2,2]),this.ctx.stroke(),this.ctx.setLineDash([])),t.segments.length<2)return;const e=t.segments[0];if(!e)return;this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y);for(let i=1;i<t.segments.length-1;i++){const n=t.segments[i],o=t.segments[i+1];if(!n||!o)continue;const l=(n.x+o.x)/2,c=(n.y+o.y)/2;this.ctx.quadraticCurveTo(n.x,n.y,l,c)}this.ctx.save(),K(this.ctx,{color:t.color,intensity:t.life,blur:25}),this.ctx.strokeStyle=t.color;const s=Math.max(0,3*t.life*t.sizeMult);this.ctx.lineWidth=s,this.ctx.lineCap="round",this.ctx.globalAlpha=Math.max(0,Math.min(1,t.life)),s>0&&this.ctx.stroke(),this.ctx.restore();const a=Math.max(0,4*t.life*t.sizeMult);a>0&&(this.ctx.save(),K(this.ctx,{color:"#ffffff",intensity:t.life,blur:20}),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,a,0,Math.PI*2),this.ctx.fillStyle="#ffffff",this.ctx.fill(),this.ctx.restore()),this.ctx.save(),this.ctx.translate(e.x,e.y),this.ctx.fillStyle="rgba(255,0,0,0.5)",this.ctx.fillRect(-15,-20,30,3),this.ctx.fillStyle="#00ff00",this.ctx.fillRect(-15,-20,30*(t.hp/t.maxHp),3),this.ctx.restore(),this.ctx.globalAlpha=1,this.ctx.shadowBlur=0}}class ds{segments=[];active=!1;life=0;generate(t,e,s,a){this.segments=[],this.active=!0,this.life=1;const i=Math.floor(u.randomRange(5,12)),n=Math.random()*Math.PI*2;for(let o=0;o<i;o++){let l=n+Math.PI*2*o/i+u.randomRange(-.4,.4),c=t,h=e;const d=Math.max(s,a)*u.randomRange(.5,.9);let p=0;for(;p<d;){const m=u.randomRange(40,120);l+=u.randomRange(-.6,.6);const x=c+Math.cos(l)*m,b=h+Math.sin(l)*m;if(this.segments.push({x1:c,y1:h,x2:x,y2:b,width:Math.max(1,6-p/150),alpha:u.randomRange(.4,1)}),Math.random()<.3){const E=l+u.randomRange(.5,1.5)*(Math.random()>.5?1:-1),P=u.randomRange(30,60);this.segments.push({x1:c,y1:h,x2:c+Math.cos(E)*P,y2:h+Math.sin(E)*P,width:1,alpha:.5})}c=x,h=b,p+=m}}}update(t){this.active&&(t?this.life-=.015:this.life=1-Math.random()*.1,this.life<=0&&(this.active=!1,this.segments=[]))}draw(t){if(this.active){t.save(),t.lineCap="round",t.strokeStyle="#a5f3fc",t.beginPath();for(let e=0;e<this.segments.length;e++){const s=this.segments[e];s&&this.life*s.alpha>.05&&(t.lineWidth=s.width*this.life,t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2))}t.globalAlpha=this.life,t.stroke(),t.restore()}}}class Ot{update(t,e){t.mass>=w.CRITICAL_MASS&&t.setState(k.UNSTABLE)}}class us{update(t,e){const s=e.warpFactor;t.shake+=.8*s,t.shake>120&&(t.setState(k.EXPLODING),t.shockwaveRadius=1,e.spawnSupernovaDebris())}}class fs{update(t,e){const s=e.warpFactor;t.shockwaveRadius+=25*s,t.shake=0,t.shockwaveRadius>Math.max(e.width,e.height)*1.5&&(t.setState(k.REFORMING),t.mass=0,t.safetyTimer=200,e.initStars())}}class ps{update(t,e){const s=e.warpFactor;t.radius>w.START_RADIUS+1?t.radius-=1*s:t.setState(k.STABLE)}}class gs extends V{mass=0;radius=w.START_RADIUS;visualRadius=w.START_RADIUS;pulse=0;state=k.STABLE;shake=0;shockwaveRadius=0;safetyTimer=0;darkMatterTimer=0;upgrades={serpentBaseCost:0,serpentHealth:0,serpentSpeed:0,serpentDamage:0,balanceRate:0};debuffs={serpentCost:0,balanceRate:0,darkMatterRate:0};currentState=new Ot;states=new Map([[k.STABLE,new Ot],[k.UNSTABLE,new us],[k.EXPLODING,new fs],[k.REFORMING,new ps]]);constructor(t,e){super(t,e,"#000000")}setState(t){this.state=t,this.currentState=this.states.get(t)||new Ot}update(t){const e=t.warpFactor;this.pulse+=.05*e;const s=this.mass/w.CRITICAL_MASS,a=w.START_RADIUS+s*80;if(this.radius+=(a-this.radius)*.05*e,this.visualRadius=this.radius+Math.sin(this.pulse)*2,this.safetyTimer>0&&this.safetyTimer--,this.state!==k.UNSTABLE&&this.shake>0&&(this.shake*=.9),this.darkMatterTimer++,this.darkMatterTimer>=60){const n=this.upgrades.balanceRate*50,o=this.debuffs.balanceRate*10,l=this.debuffs.darkMatterRate*5;v.darkMatter+=Math.max(0,100+n-o-l),this.darkMatterTimer=0}this.currentState.update(this,t)}}class xs extends V{constructor(t,e){super(t,e,"rgba(139, 92, 246, 0.6)"),this.vx=u.randomRange(-.5,.5),this.vy=u.randomRange(-.5,.5)}update(t){if(t.warpFactor>1.1){const e=this.x-t.width/2,s=this.y-t.height/2,a=Math.sqrt(e*e+s*s)||1;this.x+=e/a*2*t.warpFactor,this.y+=s/a*2*t.warpFactor}else if(t.blackHole.state===k.EXPLODING){const e=t.blackHole,s=u.dist(this,e);if(s<e.shockwaveRadius+100&&s>e.shockwaveRadius-50){const a=u.angle(e,this);this.vx+=Math.cos(a)*5,this.vy+=Math.sin(a)*5}}this.applyPhysics(1,.95),(this.x<0||this.x>t.width||this.y<0||this.y>t.height)&&(t.warpFactor>1.1?(this.x=t.width/2+u.randomRange(-50,50),this.y=t.height/2+u.randomRange(-50,50)):(this.vx*=-1,this.vy*=-1))}}class Vt extends V{size;trail=[];isDebris;gravityFactor;friction;label;constructor(t,e,s,a,i,n){const o=!i&&Math.random()>.85,l=o?w.COLORS.repel:Math.random()>.6?w.COLORS.secondary:w.COLORS.white,c=u.randomChoice([w.COLORS.white,w.COLORS.primary,w.COLORS.secondary,w.COLORS.danger]);super(t,e,i?c:l),this.vx=s,this.vy=a,this.isDebris=i,this.label=n,this.size=n?4:u.randomRange(2,5),this.gravityFactor=i?-1.5:o?-2:4,this.friction=i?.98:1}update(t){const e=t.blackHole,s=u.angle(this,e),a=u.distSq(this,e);if(e.state===k.EXPLODING){if(ct.shouldDieFromShockwave(this,e)){T.createExplosion(this.x,this.y,8,this.color,t),this.markedForDeletion=!0;return}const o=(e.shockwaveRadius-100)*(e.shockwaveRadius-100),l=(e.shockwaveRadius+50)*(e.shockwaveRadius+50);a<l&&a>o&&(this.vx-=Math.cos(s)*5,this.vy-=Math.sin(s)*5,this.isDebris&&(this.vx-=Math.cos(s)*2,this.vy-=Math.sin(s)*2))}else{const o=e.visualRadius*e.visualRadius;if(e.safetyTimer===0&&a<o){T.createExplosion(this.x,this.y,5,this.color,t),e.mass+=w.MASS_GAIN_METEOR,v.darkMatter+=50,this.markedForDeletion=!0;return}const l=.4+e.mass/w.CRITICAL_MASS*.6,c=w.GRAVITY_RADIUS_BASE*(.5+l*.5),h=c*c;if(a<h){const p=1-Math.sqrt(a)/c,x=(this.gravityFactor>0?2.5*(p*p):.5*p)*this.gravityFactor*t.warpFactor*l,b=(this.gravityFactor>0?.05:.1)*t.warpFactor;this.vx+=Math.cos(s)*x+Math.cos(s+Math.PI/2)*b,this.vy+=Math.sin(s)*x+Math.sin(s+Math.PI/2)*b;const E=350*350;this.gravityFactor>0&&a<E&&(this.vx*=.96,this.vy*=.96)}}this.vx*=this.friction,this.vy*=this.friction;const i=t.warpFactor>1.1?t.warpFactor*.5:1;this.x+=this.vx*i,this.y+=this.vy*i,this.trail.push({x:this.x,y:this.y});const n=Math.min((this.isDebris?8:w.MAX_TRAIL_LENGTH)*t.warpFactor,50);this.trail.length>n&&this.trail.shift(),(this.x<-500||this.x>t.width+500||this.y<-500||this.y>t.height+500)&&(this.markedForDeletion=!0)}}var Nt=(r=>(r.IRREGULAR="IRREGULAR",r.ROCKY="ROCKY",r.SPIKY="SPIKY",r.ROUNDED="ROUNDED",r.ANGULAR="ANGULAR",r))(Nt||{});class ys{static seedCounter=0;static generate(t,e){const s=this.createRNG(e),a=Object.values(Nt),i=a[Math.floor(s()*a.length)],n=.3+s()*.5,o=s(),l=this.generateShapePoints(i,t,n,s);return{shapeType:i,size:t,irregularity:n,detailLevel:o,points:l}}static createRNG(t){t===void 0&&(t=Date.now()+this.seedCounter++);let e=t;return()=>(e=(e*9301+49297)%233280,e/233280)}static generateShapePoints(t,e,s,a){const i=[],n=6+Math.floor(a()*4);switch(t){case"IRREGULAR":for(let o=0;o<n;o++){const l=o/n*Math.PI*2,c=e*(.7+a()*.6*s);i.push({x:Math.cos(l)*c,y:Math.sin(l)*c})}break;case"ROCKY":for(let o=0;o<n;o++){const l=o/n*Math.PI*2,c=e*(.8+a()*.4*s);i.push({x:Math.cos(l)*c,y:Math.sin(l)*c})}break;case"SPIKY":for(let o=0;o<n;o++){const l=o/n*Math.PI*2,c=o%2===0?1.2:.8,h=e*c*(.7+a()*.3*s);i.push({x:Math.cos(l)*h,y:Math.sin(l)*h})}break;case"ROUNDED":for(let o=0;o<n;o++){const l=o/n*Math.PI*2,c=e*(.85+a()*.3*s);i.push({x:Math.cos(l)*c,y:Math.sin(l)*c})}break;case"ANGULAR":for(let o=0;o<n;o++){const l=o/n*Math.PI*2,c=e*(.75+a()*.5*s);i.push({x:Math.cos(l)*c,y:Math.sin(l)*c})}break}return i}static getRandomShapeType(){const t=Object.values(Nt);return t[Math.floor(Math.random()*t.length)]}}class vs{static applyPhysics(t,e){const s=e.blackHole,a=u.distSq(t,s),i=u.angle(t,s),n=e.width/2,o=e.height/2,l=u.angle(t,{x:n,y:o});if(s.state===k.EXPLODING){if(ct.shouldDieFromShockwave(t,s)){T.createExplosion(t.x,t.y,20,t.color,e),t.markedForDeletion=!0;return}const d=(s.shockwaveRadius-100)*(s.shockwaveRadius-100),p=(s.shockwaveRadius+50)*(s.shockwaveRadius+50);if(a<p&&a>d){const x=t.vx-Math.cos(i)*2,b=t.vy-Math.sin(i)*2,E=Math.sqrt(t.vx*t.vx+t.vy*t.vy),P=Math.sqrt(x*x+b*b);((t.vx*x+t.vy*b)/(E*P+.001)>.5||E<.5)&&(t.vx=x,t.vy=b)}}else{const d=Math.sqrt(t.vx*t.vx+t.vy*t.vy);if(d>.1){const x=Math.cos(l)*d,b=Math.sin(l)*d;t.vx=t.vx*(1-.05)+x*.05,t.vy=t.vy*(1-.05)+b*.05}const p=s.visualRadius*s.visualRadius;if(s.safetyTimer===0&&a<p){T.createExplosion(t.x,t.y,15,t.color,e),s.mass+=w.MASS_GAIN_METEOR*3,v.darkMatter+=500,t.markedForDeletion=!0;return}}t.vx*=t.friction,t.vy*=t.friction;const c=e.warpFactor>1.1?e.warpFactor*.5:1;t.x+=t.vx*c,t.y+=t.vy*c,t.rotation+=t.rotationSpeed*e.warpFactor,t.trail.push({x:t.x,y:t.y});const h=Math.min(w.MAX_BIG_METEOR_TRAIL*e.warpFactor,60);t.trail.length>h&&t.trail.shift()}}class ms{static checkCollisions(t,e){const s=t.size+50,a=e.spatialGrid.query(t.x,t.y,s);for(const i of a)if(i instanceof X){const n=i,o=n.sizeMult*5;Z.checkCircleCollision(t,n,t.size,o)&&(J.applyDamageToShip(n,9999,e),T.createExplosion(n.x,n.y,20,n.color,e))}else if(i instanceof G){const n=i;for(const o of n.segments)if(Z.checkCircleCollision(t,o,t.size,0)){J.applyDamageToSerpent(n,9999,e),T.createExplosion(o.x,o.y,20,n.color,e);break}}else if(i instanceof Vt){const n=i;Z.checkCircleCollision(t,n,t.size,n.size)&&(n.markedForDeletion=!0,T.createExplosion(n.x,n.y,10,n.color,e))}}}class bs extends V{size;trail=[];gravityFactor=4;friction=1;rotation=0;rotationSpeed=0;hp=5;maxHp=5;visualConfig;constructor(t,e,s,a){const i=Math.random()>.6?w.COLORS.secondary:w.COLORS.white;super(t,e,i),this.size=u.randomRange(6,15),this.hp=5,this.maxHp=5,this.rotationSpeed=u.randomRange(-.05,.05),this.rotation=Math.random()*Math.PI*2,this.visualConfig=ys.generate(this.size),this.vx=s*.4,this.vy=a*.4}update(t){if(vs.applyPhysics(this,t),!this.markedForDeletion){if(ms.checkCollisions(this,t),this.hp<=0){gt.handleBigMeteorDeath(this,t);return}(this.x<-500||this.x>t.width+500||this.y<-500||this.y>t.height+500)&&(this.markedForDeletion=!0)}}}class Rt{static applyDebuffs(t){t.debuffs.serpentCost=v.blackHoleSerpentCostDebuff,t.debuffs.balanceRate=v.blackHoleBalanceRateDebuff,t.debuffs.darkMatterRate=v.blackHoleDarkMatterRateDebuff}static autoBuyUpgrade(t){const e=[{type:"serpentBaseCost",cost:this.getUpgradeCost(t,"serpentBaseCost")},{type:"serpentHealth",cost:this.getUpgradeCost(t,"serpentHealth")},{type:"serpentSpeed",cost:this.getUpgradeCost(t,"serpentSpeed")},{type:"serpentDamage",cost:this.getUpgradeCost(t,"serpentDamage")},{type:"balanceRate",cost:this.getUpgradeCost(t,"balanceRate")}];e.sort((s,a)=>s.cost-a.cost);for(const s of e)if(v.darkMatter>=s.cost){v.darkMatter-=s.cost,t.upgrades[s.type]++;break}}static getUpgradeCost(t,e){const s=t.upgrades[e],a={serpentBaseCost:200,serpentHealth:300,serpentSpeed:250,serpentDamage:400,balanceRate:500},i={serpentBaseCost:1.5,serpentHealth:1.6,serpentSpeed:1.55,serpentDamage:1.65,balanceRate:1.7},n=a[e],o=i[e];return Math.floor(n*Math.pow(o,s))}}class it{entities=[];add(t){this.entities.push(t)}remove(t){const e=this.entities.indexOf(t);e!==-1&&this.entities.splice(e,1)}getAll(){return this.entities}get count(){return this.entities.length}updateAndRender(t,e,s){for(const a of this.entities)a&&!a.markedForDeletion&&(a.update(t),s(a,e,t));this.entities=this.entities.filter(a=>a&&!a.markedForDeletion)}updateOnly(t){for(const e of this.entities)e&&!e.markedForDeletion&&e.update(t);this.entities=this.entities.filter(e=>e&&!e.markedForDeletion)}renderOnly(t,e,s){for(const a of this.entities)a&&!a.markedForDeletion&&e(a,t,s)}clear(){this.entities=[]}filter(t){return this.entities.filter(t)}find(t){return this.entities.find(t)}forEach(t){this.entities.forEach(t)}}class ws{update(t){const e=t.blackHole.upgrades.serpentBaseCost*50,s=t.blackHole.debuffs.serpentCost*50,a=Math.max(100,500-e+s),i=t.serpents.count>0?100*Math.pow(2,t.serpents.count-1):0,n=a+i;t.blackHole.state===k.STABLE&&v.darkMatter<n&&Rt.autoBuyUpgrade(t.blackHole),t.blackHole.state===k.STABLE&&v.darkMatter>=n&&(v.darkMatter-=n,t.spawnSerpent()),t.serpents.updateOnly(t)}render(t,e){t.serpents.renderOnly(e,(s,a)=>{a.drawVoidSerpent(s)},t)}}class Ms{update(t){for(;t.ships.count<w.SHIP_COUNT;)t.spawnShip();t.ships.updateOnly(t)}render(t,e){t.ships.renderOnly(e,(s,a)=>{a.drawShip(s)},t)}}class Ss{update(t){const e=t.meteors.filter(s=>!s.isDebris).length;t.blackHole.state!==k.EXPLODING&&e<w.MAX_METEORS&&Math.random()<.05&&t.spawnMeteor(),t.meteors.updateOnly(t)}render(t,e){const s=t.meteors.getAll();s.length>0&&e.drawMeteorsBatch(s,t.warpFactor),t.bigMeteor&&e.drawBigMeteor(t.bigMeteor,t.warpFactor)}}class bt{static checkCollisions(t,e){if(e.bigMeteor&&Z.checkCircleCollision(t,e.bigMeteor,t.size,e.bigMeteor.size)){bt.onHitBigMeteor(t,e);return}const s=t.size+50,a=e.spatialGrid.query(t.x,t.y,s);for(const i of a)if(i instanceof X){const n=i;if(n.color===t.color)continue;if(Z.checkShipCollision(t,n,12,t.size)){bt.onHitShip(t,n,e);return}}else if(i instanceof G){const n=i;if(n.segments&&n.segments.length>0){const o=n.segments[0];if(o){const l=20*(n.sizeMult||1);if(Z.checkCircleCollision(t,o,t.size,l)){bt.onHitSerpent(t,n,e);return}}}}}static onHitBigMeteor(t,e){e.bigMeteor&&(J.applyDamageToBigMeteor(e.bigMeteor,.1,e),T.createExplosion(t.x,t.y,8,t.color,e),t.markedForDeletion=!0)}static onHitShip(t,e,s){J.applyDamageToShip(e,t.damage,s),t.createHitEffect(s,(a,i,n)=>{T.createExplosion(a,i,5,n,s)}),t.shouldDeleteOnHit()&&(t.markedForDeletion=!0)}static onHitSerpent(t,e,s){J.applyDamageToSerpent(e,t.damage,s),t.createHitEffect(s,(a,i,n)=>{T.createExplosion(a,i,5,n,s)}),t.shouldDeleteOnHit()&&(t.markedForDeletion=!0)}}class Ts{update(t){const e=[];for(const s of t.projectiles.getAll())s.markedForDeletion||(s.update(t),!s.markedForDeletion&&!(s instanceof fe)&&bt.checkCollisions(s,t)),s.markedForDeletion&&e.push(s);t.projectiles.updateOnly(t);for(const s of e)t.projectilePool.release(s)}render(t,e){t.projectiles.renderOnly(e,(s,a)=>{a.drawProjectile(s)},t)}}class Es{update(t){t.blackHole.state!==k.EXPLODING&&Math.random()<w.POWERUP_RATE&&t.spawnPowerUp(),t.powerUps.updateOnly(t);for(const e of t.powerUps.getAll()){if(e.markedForDeletion)continue;const s=t.spatialGrid.query(e.x,e.y,50);for(const a of s)if(a instanceof X){const i=a;if(Z.checkCircleCollision(e,i,25,0)){W.apply(e.type,i,t),e.markedForDeletion=!0;break}}else if(a instanceof G&&!e.markedForDeletion){const i=a;if(i.segments.length>0){const n=i.segments[0];if(n&&Z.checkCircleCollision(e,n,25,20)){W.apply(e.type,i,t),e.markedForDeletion=!0;break}}}}}render(t,e){t.powerUps.renderOnly(e,(s,a)=>{a.drawPowerUp(s)},t)}}class Rs{update(t){const e=[];for(const s of t.particles.getAll())s.markedForDeletion||s.update(),s.markedForDeletion&&e.push(s);t.particles.updateOnly(t);for(const s of e)t.particlePool.release(s)}render(t,e){const s=t.particles.getAll();s.length>0&&e.drawParticlesBatch(s)}}class Ds{update(t){t.floatingTexts.updateOnly(t)}render(t,e){t.floatingTexts.renderOnly(e,(s,a)=>{s.draw(a.ctx)},t)}}class Ps{update(t){t.shockwaves.updateOnly(t)}render(t,e){t.shockwaves.renderOnly(e,(s,a)=>{s.draw(a.ctx)},t)}}class Ft{pool=[];createFn;maxSize;constructor(t,e=10,s=200){this.createFn=t,this.maxSize=s;for(let a=0;a<e;a++)this.pool.push(t())}acquire(){return this.pool.length>0?this.pool.pop():this.createFn()}release(t){this.pool.length<this.maxSize&&(t.reset(),this.pool.push(t))}clear(){this.pool=[]}get size(){return this.pool.length}}class Zt extends ls{reset(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.color="#ffffff",this.size=1,this.life=1,this.markedForDeletion=!1}}class ks{pool;constructor(t=50,e=300){this.pool=new Ft(()=>new Zt(0,0,"#ffffff",1,0,0),t,e)}acquire(t,e,s,a,i,n){const o=this.pool.acquire();return o.x=t,o.y=e,o.color=s,o.size=a,o.vx=i,o.vy=n,o.life=1,o.markedForDeletion=!1,o}release(t){t instanceof Zt&&this.pool.release(t)}clear(){this.pool.clear()}get size(){return this.pool.size}}class Qt extends Ge{reset(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.color="#8b5cf6",this.damage=1,this.size=2,this.life=60,this.maxLife=60,this.markedForDeletion=!1}}class te extends fe{reset(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.damage=6,this.size=4,this.life=300,this.maxLife=300,this.markedForDeletion=!1}}class As{linearPool;bombPool;constructor(t=20,e=100,s=10,a=50){this.linearPool=new Ft(()=>new Qt(0,0,0,0,"#8b5cf6",1,2,60),t,e),this.bombPool=new Ft(()=>new te(0,0,0,0,6),s,a)}acquireLinear(t,e,s,a,i,n,o,l){const c=this.linearPool.acquire();return c.x=t,c.y=e,c.vx=s,c.vy=a,c.color=i,c.damage=n,c.size=o,c.life=l,c.maxLife=l,c.markedForDeletion=!1,c}acquireBomb(t,e,s,a,i){const n=this.bombPool.acquire();return n.x=t,n.y=e,n.vx=s,n.vy=a,n.damage=i,n.life=300,n.maxLife=300,n.markedForDeletion=!1,n}release(t){t instanceof Qt?this.linearPool.release(t):t instanceof te&&this.bombPool.release(t)}clear(){this.linearPool.clear(),this.bombPool.clear()}get size(){return this.linearPool.size+this.bombPool.size}}class Cs{spawnMeteor(t){const e=Math.random()*Math.PI*2,s=Math.max(t.width,t.height)*.7,a=t.blackHole.x+Math.cos(e)*s,i=t.blackHole.y+Math.sin(e)*s,o=Math.random()>.85?500:100,l=t.blackHole.x+(Math.random()-.5)*o,c=t.blackHole.y+(Math.random()-.5)*o,h=u.angle({x:a,y:i},{x:l,y:c}),d=u.randomRange(2,4);t.meteors.add(new Vt(a,i,Math.cos(h)*d,Math.sin(h)*d,!1))}spawnBigMeteor(t){if(t.bigMeteor!==null)return;const e=Math.random()*Math.PI*2,s=Math.max(t.width,t.height)*.7,a=t.blackHole.x+Math.cos(e)*s,i=t.blackHole.y+Math.sin(e)*s,n=t.width/2,o=t.height/2,l=u.angle({x:a,y:i},{x:n,y:o}),c=u.randomRange(1.5,2.5);t.bigMeteor=new bs(a,i,Math.cos(l)*c,Math.sin(l)*c)}spawnShip(t){const e=Math.random()*Math.PI*2,s=Math.max(t.width,t.height)/2+50,a=t.width/2+Math.cos(e)*s,i=t.height/2+Math.sin(e)*s;t.ships.add(new X(a,i,e+Math.PI))}spawnPowerUp(t){let e,s,a;do e=u.randomRange(50,t.width-50),s=u.randomRange(50,t.height-50),a=u.distSq({x:e,y:s},t.blackHole);while(a<4e4);t.powerUps.add(new Yt(e,s))}spawnSerpent(t){const e=new G(t.blackHole.x,t.blackHole.y),s=t.blackHole.upgrades;return e.maxHp+=s.serpentHealth*10,e.hp=e.maxHp,e.speed+=s.serpentSpeed*.5,e.damageMult+=s.serpentDamage*.5,t.serpents.add(e),e}}class _s{grid=new Map;cellSize;constructor(t=100){this.cellSize=t}getCellKey(t,e){const s=Math.floor(t/this.cellSize),a=Math.floor(e/this.cellSize);return`${s},${a}`}*getCellKeysForArea(t,e,s){const a=Math.floor((t-s)/this.cellSize),i=Math.floor((t+s)/this.cellSize),n=Math.floor((e-s)/this.cellSize),o=Math.floor((e+s)/this.cellSize),l=1e4;if((i-a+1)*(o-n+1)>l){const h=Math.sqrt(l/Math.PI)*this.cellSize,d=Math.floor((t-h)/this.cellSize),p=Math.floor((t+h)/this.cellSize),m=Math.floor((e-h)/this.cellSize),x=Math.floor((e+h)/this.cellSize);for(let b=d;b<=p;b++)for(let E=m;E<=x;E++)yield`${b},${E}`}else for(let h=a;h<=i;h++)for(let d=n;d<=o;d++)yield`${h},${d}`}insert(t){const e=this.getCellKey(t.x,t.y);this.grid.has(e)||this.grid.set(e,new Set),this.grid.get(e).add(t)}remove(t){const e=this.getCellKey(t.x,t.y),s=this.grid.get(e);s&&(s.delete(t),s.size===0&&this.grid.delete(e))}update(t,e,s){const a=this.getCellKey(e,s),i=this.getCellKey(t.x,t.y);if(a!==i){const n=this.grid.get(a);n&&(n.delete(t),n.size===0&&this.grid.delete(a)),this.insert(t)}}query(t,e,s){const i=Math.min(s,500),n=new Set,o=i*i;for(const l of this.getCellKeysForArea(t,e,i)){const c=this.grid.get(l);if(c)for(const h of c){const d=h.x-t,p=h.y-e;d*d+p*p<=o&&n.add(h)}}return Array.from(n)}clear(){this.grid.clear()}get cellCount(){return this.grid.size}}class Is{canvas;renderer;width=0;height=0;warpFactor=1;mouse={x:-1e3,y:-1e3,down:!1};blackHole;stars=[];meteors=new it;bigMeteor=null;ships=new it;projectiles=new it;particles=new it;serpents=new it;cracks;shockwaves=new it;powerUps=new it;floatingTexts=new it;systems=new Map;particlePool=new ks(50,300);projectilePool=new As(20,100,10,50);spawnManager=new Cs;spatialGrid=new _s(100);constructor(t){this.canvas=t,this.renderer=new hs(t.getContext("2d")),this.blackHole=new gs(0,0),this.cracks=new ds,this.resize(),this.initStars(),this.initSystems()}initSystems(){this.systems.set("serpent",new ws),this.systems.set("ship",new Ms),this.systems.set("meteor",new Ss),this.systems.set("projectile",new Ts),this.systems.set("powerUp",new Es),this.systems.set("particle",new Rs),this.systems.set("floatingText",new Ds),this.systems.set("shockwave",new Ps)}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.blackHole.x=this.width/2,this.blackHole.y=this.height/2,this.stars.length===0&&this.initStars()}initStars(){this.stars=[];for(let t=0;t<w.POINT_COUNT;t++)this.stars.push(new xs(u.randomRange(0,this.width),u.randomRange(0,this.height)))}spawnMeteor(){this.spawnManager.spawnMeteor(this)}spawnBigMeteor(){this.spawnManager.spawnBigMeteor(this)}spawnShip(){this.spawnManager.spawnShip(this)}spawnLaser(t,e,s,a,i,n,o=1){const c=new Bt().config,h=(Math.random()-.5)*c.spread,d=s+Math.cos(i+h)*c.speed,p=a+Math.sin(i+h)*c.speed,m=this.projectilePool.acquireLinear(t+Math.cos(i)*15,e+Math.sin(i)*15,d,p,n||"#8b5cf6",c.damage*o,2,60);this.projectiles.add(m)}spawnPowerUp(){this.spawnManager.spawnPowerUp(this)}spawnBomb(t,e,s,a,i,n=1){T.spawnBomb(t,e,s,a,i,n,this)}createExplosion(t,e,s,a){T.createExplosion(t,e,s,a,this)}spawnSupernovaDebris(){for(let e=0;e<60;e++){const s=Math.random()*Math.PI*2,a=u.randomRange(15,40);this.meteors.add(new Vt(this.blackHole.x,this.blackHole.y,Math.cos(s)*a,Math.sin(s)*a,!0))}T.createExplosion(this.blackHole.x,this.blackHole.y,50,"#ffffff",this),this.cracks.generate(this.blackHole.x,this.blackHole.y,this.width,this.height)}spawnSerpent(){this.spawnManager.spawnSerpent(this)}applyDebuffsToBlackHole(){Rt.applyDebuffs(this.blackHole)}autoBuyBlackHoleUpgrades(){Rt.autoBuyUpgrade(this.blackHole)}getBlackHoleUpgradeCost(t){return Rt.getUpgradeCost(this.blackHole,t)}addCoins(t,e,s){T.addCoins(t,e,s,this)}addDarkMatter(t,e,s){T.addDarkMatter(t,e,s,this)}spawnDamageText(t,e,s,a){T.spawnDamageText(t,e,s,a,this)}spawnShockwave(t,e){T.spawnShockwave(t,e,this)}update(){this.updateInput(),this.renderClear(),this.updateSystems(),this.renderSystems()}updateInput(){this.mouse.down?this.warpFactor+=(5-this.warpFactor)*.05:this.warpFactor+=(1-this.warpFactor)*.05}renderClear(){this.renderer.clear(this.width,this.height,this.warpFactor,this.blackHole.state===k.EXPLODING,this.blackHole.shockwaveRadius);const t=Date.now();this.renderer.drawNebula(this.width,this.height,t,this.blackHole.state===k.EXPLODING,this.blackHole.shockwaveRadius),this.blackHole.state!==k.EXPLODING&&this.renderer.applyTrailEffect(this.width,this.height,this.warpFactor),this.cracks.update(this.blackHole.state===k.REFORMING),this.renderer.ctx&&this.cracks.draw(this.renderer.ctx),this.blackHole.update(this),this.renderer.drawBlackHole(this.blackHole),this.stars.forEach(e=>e.update(this)),this.renderer.drawStars(this.stars,this.warpFactor),this.bigMeteor===null?this.blackHole.state!==k.EXPLODING&&this.spawnBigMeteor():(this.bigMeteor.update(this),this.renderer.drawBigMeteor(this.bigMeteor,this.warpFactor),this.bigMeteor.markedForDeletion&&(this.bigMeteor=null,this.blackHole.state!==k.EXPLODING&&this.spawnBigMeteor()))}updateSystems(){this.updateSpatialGrid();for(const t of this.systems.values())t.update(this)}updateSpatialGrid(){this.spatialGrid.clear();for(const t of this.ships.getAll())this.spatialGrid.insert(t);for(const t of this.serpents.getAll())this.spatialGrid.insert(t);for(const t of this.meteors.getAll())this.spatialGrid.insert(t);for(const t of this.powerUps.getAll())this.spatialGrid.insert(t);this.bigMeteor&&this.spatialGrid.insert(this.bigMeteor)}renderSystems(){for(const t of this.systems.values())t.render(this,this.renderer)}}const Os={class:"fixed inset-0 bg-[#0a0a0a] overflow-hidden font-mono text-white select-none"},Ls={key:0,class:"absolute top-0 left-0 p-3 md:p-6 z-10 pointer-events-none"},Bs={class:"flex items-center gap-4"},Gs={class:"text-2xl md:text-4xl font-bold text-yellow-400 drop-shadow-md"},zs={class:"text-2xl md:text-4xl font-bold text-purple-400 drop-shadow-md"},Hs=["title"],Ns={key:0,class:"absolute top-[80px] md:top-[60px] right-0 p-2 md:p-6 flex flex-col items-end space-y-2 md:space-y-4 z-10 pointer-events-none shop-container"},Fs={key:0,class:"flex flex-col space-y-1 md:space-y-2 pointer-events-auto max-h-[calc(100vh-120px)] md:max-h-none overflow-y-auto pr-1 md:pr-0"},$s=["disabled"],Us={class:"flex justify-between items-center w-36 md:w-48"},qs={class:"text-yellow-400 text-[10px] md:text-xs"},js={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},Ws=["disabled"],Xs={class:"flex justify-between items-center w-36 md:w-48"},Ys={class:"text-yellow-400 text-[10px] md:text-xs"},Vs={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},Ks=["disabled"],Js={class:"flex justify-between items-center w-36 md:w-48"},Zs={class:"text-yellow-400 text-[10px] md:text-xs"},Qs={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},ta=["disabled"],ea={class:"flex justify-between items-center w-36 md:w-48"},sa={class:"text-yellow-400 text-[10px] md:text-xs"},aa={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},ia=["disabled"],oa={class:"flex justify-between items-center w-36 md:w-48"},na={class:"text-yellow-400 text-[10px] md:text-xs"},ra={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},la=["disabled"],ca={class:"flex justify-between items-center w-36 md:w-48"},ha={class:"text-yellow-400 text-[10px] md:text-xs"},da={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},ua=["disabled"],fa={class:"flex justify-between items-center w-36 md:w-48"},pa={class:"text-yellow-400 text-[10px] md:text-xs"},ga={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},xa=["disabled"],ya={class:"flex justify-between items-center w-36 md:w-48"},va={class:"text-yellow-400 text-[10px] md:text-xs"},ma={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},ba=["disabled"],wa={class:"flex justify-between items-center w-36 md:w-48"},Ma={class:"text-yellow-400 text-[10px] md:text-xs"},Sa={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},Ta=["disabled"],Ea={class:"flex justify-between items-center w-36 md:w-48"},Ra={class:"text-yellow-400 text-[10px] md:text-xs"},Da={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},Pa=["disabled"],ka={class:"flex justify-between items-center w-36 md:w-48"},Aa={class:"text-yellow-400 text-[10px] md:text-xs"},Ca={class:"text-[9px] md:text-[10px] text-gray-500 text-right"},_a={key:0,class:"text-[9px] md:text-[10px] text-gray-600 pt-2 md:pt-4 text-right pointer-events-auto"},Ia=Ut({__name:"index",props:{showUI:{type:Boolean,default:!0}},setup(r){const t=lt(null),e=lt(!0);let s=null,a;const i=Y(()=>v.darkMatter),n=()=>{e.value=!e.value},o=S=>{S.stopPropagation()},l=()=>{s?.resize()},c=S=>{s&&(s.mouse.x=S.clientX,s.mouse.y=S.clientY)},h=()=>{s&&(s.mouse.down=!0)},d=()=>{s&&(s.mouse.down=!1)},p=S=>!S||!(S instanceof HTMLElement)?!1:S.closest("button, .shop-container, .pointer-events-auto")!==null,m=S=>{if(!p(S.target)&&(S.preventDefault(),s&&S.touches.length>0)){const f=S.touches[0];f&&(s.mouse.x=f.clientX,s.mouse.y=f.clientY,s.mouse.down=!0)}},x=S=>{if(!p(S.target)&&(S.preventDefault(),s&&S.touches.length>0)){const f=S.touches[0];f&&(s.mouse.x=f.clientX,s.mouse.y=f.clientY)}},b=S=>{p(S.target)||(S.preventDefault(),s&&(s.mouse.down=!1))},E=S=>{p(S.target)||(S.preventDefault(),s&&(s.mouse.down=!1))},P=()=>{s?.update(),a=requestAnimationFrame(P)};return At(()=>{t.value&&(s=new Is(t.value),P(),window.addEventListener("resize",l),window.addEventListener("mousemove",c),window.addEventListener("mousedown",h),window.addEventListener("mouseup",d),window.addEventListener("touchstart",m,{passive:!1}),window.addEventListener("touchmove",x,{passive:!1}),window.addEventListener("touchend",b,{passive:!1}),window.addEventListener("touchcancel",E,{passive:!1}))}),ae(()=>{cancelAnimationFrame(a),window.removeEventListener("resize",l),window.removeEventListener("mousemove",c),window.removeEventListener("mousedown",h),window.removeEventListener("mouseup",d),window.removeEventListener("touchstart",m),window.removeEventListener("touchmove",x),window.removeEventListener("touchend",b),window.removeEventListener("touchcancel",E)}),(S,f)=>(L(),B("div",Os,[g("canvas",{ref_key:"canvasRef",ref:t,class:"absolute inset-0 block touch-none",style:{"z-index":"0","pointer-events":"auto"}},null,512),H(vt,{name:"balance-fade"},{default:yt(()=>[r.showUI?ut("",!0):(L(),B("div",Ls,[g("div",Bs,[g("div",Gs,C(Math.floor(y(v).coins))+"$ ",1),g("div",zs,C(Math.floor(i.value))+"âš« ",1)])]))]),_:1}),H(vt,{name:"shop-fade"},{default:yt(()=>[r.showUI?ut("",!0):(L(),B("button",{key:0,onClick:R(n,["stop"]),onTouchstart:R(o,["stop"]),onTouchend:R(n,["stop","prevent"]),class:"absolute top-[25px] md:top-[20px] right-[70px] md:right-[80px] z-20 w-8 h-8 md:w-10 md:h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 active:bg-white/20 border border-white/20 rounded-lg transition-all duration-300 pointer-events-auto touch-manipulation group",title:e.value?"Collapse controls":"Expand controls"},[(L(),B("svg",{class:Lt(["w-4 h-4 md:w-5 md:h-5 text-white transition-transform duration-300",{"rotate-180":!e.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...f[22]||(f[22]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],40,Hs))]),_:1}),H(vt,{name:"shop-fade"},{default:yt(()=>[r.showUI?ut("",!0):(L(),B("div",Ns,[H(vt,{name:"shop-expand"},{default:yt(()=>[e.value?(L(),B("div",Fs,[g("button",{onClick:f[0]||(f[0]=R(M=>y(O)("ship"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[1]||(f[1]=R(M=>y(O)("ship"),["stop","prevent"])),class:"group relative px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",disabled:y(v).coins<y(I).ship},[g("div",Us,[f[23]||(f[23]=g("span",{class:"text-xs md:text-sm text-gray-300 group-hover:text-white group-active:text-white"},"Add Ship",-1)),g("span",qs,C(y(I).ship)+"$",1)]),g("div",js,"Count: "+C(y(v).shipsCount),1)],40,$s),g("button",{onClick:f[2]||(f[2]=R(M=>y(O)("damage"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[3]||(f[3]=R(M=>y(O)("damage"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).damage},[g("div",Xs,[f[24]||(f[24]=g("span",{class:"text-xs md:text-sm text-gray-300 group-hover:text-white group-active:text-white"},"Damage",-1)),g("span",Ys,C(y(I).damage)+"$",1)]),g("div",Vs,"Lvl: "+C(y(v).damageLevel),1)],40,Ws),g("button",{onClick:f[4]||(f[4]=R(M=>y(O)("hull"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[5]||(f[5]=R(M=>y(O)("hull"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).hull},[g("div",Js,[f[25]||(f[25]=g("span",{class:"text-xs md:text-sm text-gray-300 group-hover:text-white group-active:text-white"},"Hull HP",-1)),g("span",Zs,C(y(I).hull)+"$",1)]),g("div",Qs,"Lvl: "+C(y(v).hullLevel),1)],40,Ks),g("button",{onClick:f[6]||(f[6]=R(M=>y(O)("turret"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[7]||(f[7]=R(M=>y(O)("turret"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).turret},[g("div",ea,[f[26]||(f[26]=g("span",{class:"text-xs md:text-sm text-gray-300 group-hover:text-white group-active:text-white"},"Fire Rate",-1)),g("span",sa,C(y(I).turret)+"$",1)]),g("div",aa,"Lvl: "+C(y(v).turretSpeed),1)],40,ta),f[34]||(f[34]=g("div",{class:"h-px bg-white/10 my-1 md:my-2"},null,-1)),g("button",{onClick:f[8]||(f[8]=R(M=>y(O)("shield"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[9]||(f[9]=R(M=>y(O)("shield"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).shield},[g("div",oa,[f[27]||(f[27]=g("span",{class:"text-xs md:text-sm text-blue-400 group-hover:text-blue-300 group-active:text-blue-300"},"Shield Gen",-1)),g("span",na,C(y(I).shield)+"$",1)]),g("div",ra,"Max: "+C(y(v).shieldLevel*5),1)],40,ia),g("button",{onClick:f[10]||(f[10]=R(M=>y(O)("crit"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[11]||(f[11]=R(M=>y(O)("crit"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).crit},[g("div",ca,[f[28]||(f[28]=g("span",{class:"text-xs md:text-sm text-red-400 group-hover:text-red-300 group-active:text-red-300"},"Crit Chance",-1)),g("span",ha,C(y(I).crit)+"$",1)]),g("div",da,"Chance: "+C(y(v).critLevel*5)+"%",1)],40,la),g("button",{onClick:f[12]||(f[12]=R(M=>y(O)("regen"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[13]||(f[13]=R(M=>y(O)("regen"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).regen},[g("div",fa,[f[29]||(f[29]=g("span",{class:"text-xs md:text-sm text-green-400 group-hover:text-green-300 group-active:text-green-300"},"Nanobots",-1)),g("span",pa,C(y(I).regen)+"$",1)]),g("div",ga,"Lvl: "+C(y(v).regenLevel),1)],40,ua),g("button",{onClick:f[14]||(f[14]=R(M=>y(O)("magnet"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[15]||(f[15]=R(M=>y(O)("magnet"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-white/5 active:bg-white/10 hover:bg-white/10 border border-white/10 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).magnet},[g("div",ya,[f[30]||(f[30]=g("span",{class:"text-xs md:text-sm text-purple-400 group-hover:text-purple-300 group-active:text-purple-300"},"Magnet",-1)),g("span",va,C(y(I).magnet)+"$",1)]),g("div",ma,"Range: "+C(500+(y(v).magnetLevel-1)*150),1)],40,xa),f[35]||(f[35]=g("div",{class:"h-px bg-white/10 my-1 md:my-2"},null,-1)),f[36]||(f[36]=g("div",{class:"text-[10px] md:text-xs text-red-400 font-semibold mb-1"},"Black Hole Debuffs",-1)),g("button",{onClick:f[16]||(f[16]=R(M=>y(O)("blackHoleSerpentCost"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[17]||(f[17]=R(M=>y(O)("blackHoleSerpentCost"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-red-500/10 active:bg-red-500/20 hover:bg-red-500/20 border border-red-500/20 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).blackHoleSerpentCost},[g("div",wa,[f[31]||(f[31]=g("span",{class:"text-xs md:text-sm text-red-300 group-hover:text-red-200 group-active:text-red-200"},"Increase Serpent Cost",-1)),g("span",Ma,C(y(I).blackHoleSerpentCost)+"$",1)]),g("div",Sa,"+"+C(y(v).blackHoleSerpentCostDebuff*50)+"$ base cost",1)],40,ba),g("button",{onClick:f[18]||(f[18]=R(M=>y(O)("blackHoleBalanceRate"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[19]||(f[19]=R(M=>y(O)("blackHoleBalanceRate"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-red-500/10 active:bg-red-500/20 hover:bg-red-500/20 border border-red-500/20 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).blackHoleBalanceRate},[g("div",Ea,[f[32]||(f[32]=g("span",{class:"text-xs md:text-sm text-red-300 group-hover:text-red-200 group-active:text-red-200"},"Reduce Balance Rate",-1)),g("span",Ra,C(y(I).blackHoleBalanceRate)+"$",1)]),g("div",Da,"-"+C(y(v).blackHoleBalanceRateDebuff*10)+"$/sec",1)],40,Ta),g("button",{onClick:f[20]||(f[20]=R(M=>y(O)("blackHoleDarkMatterRate"),["stop"])),onTouchstart:R(o,["stop"]),onTouchend:f[21]||(f[21]=R(M=>y(O)("blackHoleDarkMatterRate"),["stop","prevent"])),class:"group px-2 md:px-4 py-1.5 md:py-2 bg-red-500/10 active:bg-red-500/20 hover:bg-red-500/20 border border-red-500/20 rounded-lg transition-all disabled:opacity-50 touch-manipulation",disabled:y(v).coins<y(I).blackHoleDarkMatterRate},[g("div",ka,[f[33]||(f[33]=g("span",{class:"text-xs md:text-sm text-red-300 group-hover:text-red-200 group-active:text-red-200"},"Reduce Dark Matter Rate",-1)),g("span",Aa,C(y(I).blackHoleDarkMatterRate)+"$",1)]),g("div",Ca,"-"+C(y(v).blackHoleDarkMatterRateDebuff*5)+"âš«/sec",1)],40,Pa)])):ut("",!0)]),_:1}),H(vt,{name:"shop-expand"},{default:yt(()=>[e.value?(L(),B("div",_a,[...f[37]||(f[37]=[g("span",{class:"hidden md:inline"},[Q("Hold Click: Warp Drive"),g("br")],-1),g("span",{class:"md:hidden"},[Q("Hold Touch: Warp"),g("br")],-1),Q(" Killing Serpents gives $$$ ",-1)])])):ut("",!0)]),_:1})]))]),_:1})]))}}),Oa=Object.assign(ie(Ia,[["__scopeId","data-v-aa0abd8b"]]),{__name:"Background"}),La={trailing:!0};function Ba(r,t=25,e={}){if(e={...La,...e},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let s,a,i=[],n,o;const l=(d,p)=>(n=Ga(r,d,p),n.finally(()=>{if(n=null,e.trailing&&o&&!a){const m=l(d,o);return o=null,m}}),n),c=function(...d){return e.trailing&&(o=d),n||new Promise(p=>{const m=!a&&e.leading;clearTimeout(a),a=setTimeout(()=>{a=null;const x=e.leading?s:l(this,d);o=null;for(const b of i)b(x);i=[]},t),m?(s=l(this,d),p(s)):i.push(p)})},h=d=>{d&&(clearTimeout(d),a=null)};return c.isPending=()=>!!a,c.cancel=()=>{h(a),i=[],o=null},c.flush=()=>{if(h(a),!o||n)return;const d=o;return o=null,l(this,d)},c}async function Ga(r,t,e){return await r.apply(t,e)}function za(r){return typeof r=="string"?`'${r}'`:new Ha().serialize(r)}const Ha=(function(){class r{#t=new Map;compare(e,s){const a=typeof e,i=typeof s;return a==="string"&&i==="string"?e.localeCompare(s):a==="number"&&i==="number"?e-s:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(s,!0))}serialize(e,s){if(e===null)return"null";switch(typeof e){case"string":return s?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const s=Object.prototype.toString.call(e);if(s!=="[object Object]")return this.serializeBuiltInType(s.length<10?`unknown:${s}`:s.slice(8,-1),e);const a=e.constructor,i=a===Object||a===void 0?"":a.name;if(i!==""&&globalThis[i]===a)return this.serializeBuiltInType(i,e);if(typeof e.toJSON=="function"){const n=e.toJSON();return i+(n!==null&&typeof n=="object"?this.$object(n):`(${this.serialize(n)})`)}return this.serializeObjectEntries(i,Object.entries(e))}serializeBuiltInType(e,s){const a=this["$"+e];if(a)return a.call(this,s);if(typeof s?.entries=="function")return this.serializeObjectEntries(e,s.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,s){const a=Array.from(s).sort((n,o)=>this.compare(n[0],o[0]));let i=`${e}{`;for(let n=0;n<a.length;n++){const[o,l]=a[n];i+=`${this.serialize(o,!0)}:${this.serialize(l)}`,n<a.length-1&&(i+=",")}return i+"}"}$object(e){let s=this.#t.get(e);return s===void 0&&(this.#t.set(e,`#${this.#t.size}`),s=this.serializeObject(e),this.#t.set(e,s)),s}$function(e){const s=Function.prototype.toString.call(e);return s.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${s.replace(/\s*\n\s*/g,"")}`}$Array(e){let s="[";for(let a=0;a<e.length;a++)s+=this.serialize(e[a]),a<e.length-1&&(s+=",");return s+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((s,a)=>this.compare(s,a)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const t of["Error","RegExp","URL"])r.prototype["$"+t]=function(e){return`${t}(${e})`};for(const t of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])r.prototype["$"+t]=function(e){return`${t}[${e.join(",")}]`};for(const t of["BigInt64Array","BigUint64Array"])r.prototype["$"+t]=function(e){return`${t}[${e.join("n,")}${e.length>0?"n":""}]`};return r})(),Na=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Fa=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],$a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",nt=[];class Ua{_data=new pt;_hash=new pt([...Na]);_nDataBytes=0;_minBufferSize=0;finalize(t){t&&this._append(t);const e=this._nDataBytes*8,s=this._data.sigBytes*8;return this._data.words[s>>>5]|=128<<24-s%32,this._data.words[(s+64>>>9<<4)+14]=Math.floor(e/4294967296),this._data.words[(s+64>>>9<<4)+15]=e,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,e){const s=this._hash.words;let a=s[0],i=s[1],n=s[2],o=s[3],l=s[4],c=s[5],h=s[6],d=s[7];for(let p=0;p<64;p++){if(p<16)nt[p]=t[e+p]|0;else{const f=nt[p-15],M=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,D=nt[p-2],z=(D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10;nt[p]=M+nt[p-7]+z+nt[p-16]}const m=l&c^~l&h,x=a&i^a&n^i&n,b=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),E=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),P=d+E+m+Fa[p]+nt[p],S=b+x;d=h,h=c,c=l,l=o+P|0,o=n,n=i,i=a,a=P+S|0}s[0]=s[0]+a|0,s[1]=s[1]+i|0,s[2]=s[2]+n|0,s[3]=s[3]+o|0,s[4]=s[4]+l|0,s[5]=s[5]+c|0,s[6]=s[6]+h|0,s[7]=s[7]+d|0}_append(t){typeof t=="string"&&(t=pt.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let e,s=this._data.sigBytes/64;t?s=Math.ceil(s):s=Math.max((s|0)-this._minBufferSize,0);const a=s*16,i=Math.min(a*4,this._data.sigBytes);if(a){for(let n=0;n<a;n+=16)this._doProcessBlock(this._data.words,n);e=this._data.words.splice(0,a),this._data.sigBytes-=i}return new pt(e,i)}}class pt{words;sigBytes;constructor(t,e){t=this.words=t||[],this.sigBytes=e===void 0?t.length*4:e}static fromUtf8(t){const e=unescape(encodeURIComponent(t)),s=e.length,a=[];for(let i=0;i<s;i++)a[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8;return new pt(a,s)}toBase64(){const t=[];for(let e=0;e<this.sigBytes;e+=3){const s=this.words[e>>>2]>>>24-e%4*8&255,a=this.words[e+1>>>2]>>>24-(e+1)%4*8&255,i=this.words[e+2>>>2]>>>24-(e+2)%4*8&255,n=s<<16|a<<8|i;for(let o=0;o<4&&e*8+o*6<this.sigBytes*8;o++)t.push($a.charAt(n>>>6*(3-o)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let e=0;e<t.sigBytes;e++){const s=t.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=s<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<t.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=t.words[e>>>2];this.sigBytes+=t.sigBytes}}function qa(r){return new Ua().finalize(r).toBase64()}function ft(r){return qa(za(r))}const ja=Symbol.for("nuxt:client-only");function Wa(...r){const t=typeof r[r.length-1]=="string"?r.pop():void 0;Xa(r[0],r[1])&&r.unshift(t);let[e,s,a={}]=r,i=!1;const n=Y(()=>N(e));if(typeof n.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof s!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const o=be();a.server??=!0,a.default??=Va,a.getCachedData??=xe,a.lazy??=!1,a.immediate??=!0,a.deep??=we.deep,a.dedupe??="cancel",a._functionName,o._asyncData[n.value];function l(){const x={cause:"initial",dedupe:a.dedupe};return o._asyncData[n.value]?._init||(x.cachedData=a.getCachedData(n.value,o,{cause:"initial"}),o._asyncData[n.value]=ee(o,n.value,s,a,x.cachedData)),()=>o._asyncData[n.value].execute(x)}const c=l(),h=o._asyncData[n.value];h._deps++;const d=a.server!==!1&&o.payload.serverRendered;{let x=function(M){const D=o._asyncData[M];D?._deps&&(D._deps--,D._deps===0&&D?._off())};const b=qt();if(b&&d&&a.immediate&&!b.sp&&(b.sp=[]),b&&!b._nuxtOnBeforeMountCbs){b._nuxtOnBeforeMountCbs=[];const M=b._nuxtOnBeforeMountCbs;Me(()=>{M.forEach(D=>{D()}),M.splice(0,M.length)}),ae(()=>M.splice(0,M.length))}const E=b&&(b._nuxtClientOnly||Se(ja,!1));d&&o.isHydrating&&(h.error.value||h.data.value!==void 0)?h.status.value=h.error.value?"error":"success":b&&(!E&&o.payload.serverRendered&&o.isHydrating||a.lazy)&&a.immediate?b._nuxtOnBeforeMountCbs.push(c):a.immediate&&h.status.value!=="success"&&c();const P=ne(),S=xt(n,(M,D)=>{if((M||D)&&M!==D){i=!0;const z=o._asyncData[D]?.data.value!==void 0,A=o._asyncDataPromises[D]!==void 0,q={cause:"initial",dedupe:a.dedupe};if(!o._asyncData[M]?._init){let st;D&&z?st=o._asyncData[D].data.value:(st=a.getCachedData(M,o,{cause:"initial"}),q.cachedData=st),o._asyncData[M]=ee(o,M,s,a,st)}o._asyncData[M]._deps++,D&&x(D),(a.immediate||z||A)&&o._asyncData[M].execute(q),Re(()=>{i=!1})}},{flush:"sync"}),f=a.watch?xt(a.watch,()=>{i||h._execute({cause:"watch",dedupe:a.dedupe})}):()=>{};P&&oe(()=>{S(),f(),x(n.value)})}const p={data:St(()=>o._asyncData[n.value]?.data),pending:St(()=>o._asyncData[n.value]?.pending),status:St(()=>o._asyncData[n.value]?.status),error:St(()=>o._asyncData[n.value]?.error),refresh:(...x)=>o._asyncData[n.value]?._init?o._asyncData[n.value].execute(...x):l()(),execute:(...x)=>p.refresh(...x),clear:()=>{const x=o._asyncData[n.value];if(x?._abortController)try{x._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{x._abortController=void 0}ge(o,n.value)}},m=Promise.resolve(o._asyncDataPromises[n.value]).then(()=>p);return Object.assign(m,p),m}function St(r){return Y({get(){return r()?.value},set(t){const e=r();e&&(e.value=t)}})}function Xa(r,t){return!(typeof r=="string"||typeof r=="object"&&r!==null||typeof r=="function"&&typeof t=="function")}function ge(r,t){t in r.payload.data&&(r.payload.data[t]=void 0),t in r.payload._errors&&(r.payload._errors[t]=void 0),r._asyncData[t]&&(r._asyncData[t].data.value=y(r._asyncData[t]._default()),r._asyncData[t].error.value=void 0,r._asyncData[t].status.value="idle"),t in r._asyncDataPromises&&(r._asyncDataPromises[t]=void 0)}function Ya(r,t){const e={};for(const s of t)e[s]=r[s];return e}function ee(r,t,e,s,a){r.payload._errors[t]??=void 0;const i=s.getCachedData!==xe,n=e,o=s.deep?lt:$,l=a!==void 0,c=r.hook("app:data:refresh",async d=>{(!d||d.includes(t))&&await h.execute({cause:"refresh:hook"})}),h={data:o(l?a:s.default()),pending:Y(()=>h.status.value==="pending"),error:Te(r.payload._errors,t),status:$("idle"),execute:(...d)=>{const[p,m=void 0]=d,x=p&&m===void 0&&typeof p=="object"?p:{};if(r._asyncDataPromises[t]&&(x.dedupe??s.dedupe)==="defer")return r._asyncDataPromises[t];{const P="cachedData"in x?x.cachedData:s.getCachedData(t,r,{cause:x.cause??"refresh:manual"});if(P!==void 0)return r.payload.data[t]=h.data.value=P,h.error.value=void 0,h.status.value="success",Promise.resolve(P)}h._abortController&&h._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),h._abortController=new AbortController,h.status.value="pending";const b=new AbortController,E=new Promise((P,S)=>{try{const f=x.timeout??s.timeout,M=Ka([h._abortController?.signal,x?.signal],b.signal,f);if(M.aborted){const D=M.reason;S(D instanceof Error?D:new DOMException(String(D??"Aborted"),"AbortError"));return}return M.addEventListener("abort",()=>{const D=M.reason;S(D instanceof Error?D:new DOMException(String(D??"Aborted"),"AbortError"))},{once:!0,signal:b.signal}),Promise.resolve(n(r,{signal:M})).then(P,S)}catch(f){S(f)}}).then(async P=>{let S=P;s.transform&&(S=await s.transform(P)),s.pick&&(S=Ya(S,s.pick)),r.payload.data[t]=S,h.data.value=S,h.error.value=void 0,h.status.value="success"}).catch(P=>{if(!(r._asyncDataPromises[t]&&r._asyncDataPromises[t]!==E)&&!h._abortController?.signal.aborted){if(typeof DOMException<"u"&&P instanceof DOMException&&P.name==="AbortError"){h.status.value="idle";return}h.error.value=Ee(P),h.data.value=y(s.default()),h.status.value="error"}}).finally(()=>{b.abort(),delete r._asyncDataPromises[t]});return r._asyncDataPromises[t]=E,r._asyncDataPromises[t]},_execute:Ba((...d)=>h.execute(...d),0,{leading:!0}),_default:s.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{c(),r._asyncData[t]?._init&&(r._asyncData[t]._init=!1),i||re(()=>{r._asyncData[t]?._init||(ge(r,t),h.execute=()=>Promise.resolve())})}};return h}const Va=()=>{},xe=(r,t,e)=>{if(t.isHydrating)return t.payload.data[r];if(e.cause!=="refresh:manual"&&e.cause!=="refresh:hook")return t.static.data[r]};function Ka(r,t,e){const s=r.filter(n=>!!n);if(typeof e=="number"&&e>=0){const n=AbortSignal.timeout?.(e);n&&s.push(n)}if(AbortSignal.any)return AbortSignal.any(s);const a=new AbortController;for(const n of s)if(n.aborted){const o=n.reason??new DOMException("Aborted","AbortError");try{a.abort(o)}catch{a.abort()}return a.signal}const i=()=>{const o=s.find(l=>l.aborted)?.reason??new DOMException("Aborted","AbortError");try{a.abort(o)}catch{a.abort()}};for(const n of s)n.addEventListener?.("abort",i,{once:!0,signal:t});return a.signal}function Kt(r,t){return ne()?(oe(r,t),!0):!1}const Ja=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Za=r=>r!=null,Qa=Object.prototype.toString,ti=r=>Qa.call(r)==="[object Object]";function Dt(r){return Array.isArray(r)?r:[r]}function ei(r){return qt()}function si(r,t=!0,e){ei()?At(r,e):t?r():re(r)}function ai(r,t,e){return xt(r,t,{...e,immediate:!0})}const Mt=Ja?window:void 0;function wt(r){var t;const e=N(r);return(t=e?.$el)!==null&&t!==void 0?t:e}function rt(...r){const t=[],e=()=>{t.forEach(o=>o()),t.length=0},s=(o,l,c,h)=>(o.addEventListener(l,c,h),()=>o.removeEventListener(l,c,h)),a=Y(()=>{const o=Dt(N(r[0])).filter(l=>l!=null);return o.every(l=>typeof l!="string")?o:void 0}),i=ai(()=>{var o,l;return[(o=(l=a.value)===null||l===void 0?void 0:l.map(c=>wt(c)))!==null&&o!==void 0?o:[Mt].filter(c=>c!=null),Dt(N(a.value?r[1]:r[0])),Dt(y(a.value?r[2]:r[1])),N(a.value?r[3]:r[2])]},([o,l,c,h])=>{if(e(),!o?.length||!l?.length||!c?.length)return;const d=ti(h)?{...h}:h;t.push(...o.flatMap(p=>l.flatMap(m=>c.map(x=>s(p,m,x,d)))))},{flush:"post"}),n=()=>{i(),e()};return Kt(e),n}function ii(){const r=$(!1),t=qt();return t&&At(()=>{r.value=!0},t),r}function ye(r){const t=ii();return Y(()=>(t.value,!!r()))}function oi(r,t,e={}){const{window:s=Mt,...a}=e;let i;const n=ye(()=>s&&"MutationObserver"in s),o=()=>{i&&(i.disconnect(),i=void 0)},l=xt(Y(()=>{const d=Dt(N(r)).map(wt).filter(Za);return new Set(d)}),d=>{o(),n.value&&d.size&&(i=new MutationObserver(t),d.forEach(p=>i.observe(p,a)))},{immediate:!0,flush:"post"}),c=()=>i?.takeRecords(),h=()=>{l(),o()};return Kt(h),{isSupported:n,stop:h,takeRecords:c}}function ni(r,t,e={}){const{window:s=Mt,...a}=e;let i;const n=ye(()=>s&&"ResizeObserver"in s),o=()=>{i&&(i.disconnect(),i=void 0)},l=xt(Y(()=>{const h=N(r);return Array.isArray(h)?h.map(d=>wt(d)):[wt(h)]}),h=>{if(o(),n.value&&s){i=new ResizeObserver(t);for(const d of h)d&&i.observe(d,a)}},{immediate:!0,flush:"post"}),c=()=>{o(),l()};return Kt(c),{isSupported:n,stop:c}}const ri={page:r=>[r.pageX,r.pageY],client:r=>[r.clientX,r.clientY],screen:r=>[r.screenX,r.screenY],movement:r=>r instanceof MouseEvent?[r.movementX,r.movementY]:null};function li(r={}){const{type:t="page",touch:e=!0,resetOnTouchEnds:s=!1,initialValue:a={x:0,y:0},window:i=Mt,target:n=i,scroll:o=!0,eventFilter:l}=r;let c=null,h=0,d=0;const p=$(a.x),m=$(a.y),x=$(null),b=typeof t=="function"?t:ri[t],E=A=>{const q=b(A);c=A,q&&([p.value,m.value]=q,x.value="mouse"),i&&(h=i.scrollX,d=i.scrollY)},P=A=>{if(A.touches.length>0){const q=b(A.touches[0]);q&&([p.value,m.value]=q,x.value="touch")}},S=()=>{if(!c||!i)return;const A=b(c);c instanceof MouseEvent&&A&&(p.value=A[0]+i.scrollX-h,m.value=A[1]+i.scrollY-d)},f=()=>{p.value=a.x,m.value=a.y},M=l?A=>l(()=>E(A),{}):A=>E(A),D=l?A=>l(()=>P(A),{}):A=>P(A),z=l?()=>l(()=>S(),{}):()=>S();if(n){const A={passive:!0};rt(n,["mousemove","dragover"],M,A),e&&t!=="movement"&&(rt(n,["touchstart","touchmove"],D,A),s&&rt(n,"touchend",f,A)),o&&t==="page"&&rt(i,"scroll",z,A)}return{x:p,y:m,sourceType:x}}function ci(r,t={}){const{windowResize:e=!0,windowScroll:s=!0,handleOutside:a=!0,window:i=Mt}=t,n=t.type||"page",{x:o,y:l,sourceType:c}=li(t),h=$(r??i?.document.body),d=$(0),p=$(0),m=$(0),x=$(0),b=$(0),E=$(0),P=$(!0);function S(){if(!i)return;const D=wt(h);if(!D||!(D instanceof Element))return;const{left:z,top:A,width:q,height:st}=D.getBoundingClientRect();m.value=z+(n==="page"?i.pageXOffset:0),x.value=A+(n==="page"?i.pageYOffset:0),b.value=st,E.value=q;const _t=o.value-m.value,It=l.value-x.value;P.value=q===0||st===0||_t<0||It<0||_t>q||It>st,(a||!P.value)&&(d.value=_t,p.value=It)}const f=[];function M(){f.forEach(D=>D()),f.length=0}if(si(()=>{S()}),i){const{stop:D}=ni(h,S),{stop:z}=oi(h,S,{attributeFilter:["style","class"]}),A=xt([h,o,l],S);f.push(D,z,A),rt(document,"mouseleave",()=>P.value=!0,{passive:!0}),s&&f.push(rt("scroll",S,{capture:!0,passive:!0})),e&&f.push(rt("resize",S,{passive:!0}))}return{x:o,y:l,sourceType:c,elementX:d,elementY:p,elementPositionX:m,elementPositionY:x,elementHeight:b,elementWidth:E,isOutside:P,stop:M}}const hi=["href"],di={class:"relative z-10"},ui={class:"flex justify-between items-start mb-4"},fi={class:"p-2 bg-white/5 rounded-lg group-hover:bg-primary/20 transition-colors duration-300"},pi={class:"flex items-center space-x-1 text-gray-400 bg-black/20 px-2 py-1 rounded-full"},gi={class:"text-xs font-mono font-bold"},xi={class:"text-lg font-bold text-white mb-2 group-hover:text-primary transition-colors"},yi={class:"text-gray-400 text-sm leading-relaxed mb-4 line-clamp-3 h-[4.5em]"},vi={class:"flex flex-wrap gap-2 mb-4 h-6 overflow-hidden"},mi={class:"relative z-10 flex items-center justify-between mt-auto border-t border-white/5 pt-4"},bi={class:"flex items-center gap-2"},wi=Ut({__name:"ProjectCard",props:{project:{},index:{}},setup(r){const t=lt(null),{elementX:e,elementY:s,isOutside:a,elementHeight:i,elementWidth:n}=ci(t),o=Y(()=>{if(a.value)return"";const h=6,d=(h/2-s.value/i.value*h).toFixed(2),p=(e.value/n.value*h-h/2).toFixed(2);return`perspective(1000px) rotateX(${d}deg) rotateY(${p}deg) scale(1.02)`}),l={TypeScript:"text-blue-400",Vue:"text-green-400",Python:"text-yellow-400",PHP:"text-purple-400",JavaScript:"text-yellow-300",Go:"text-cyan-400",HTML:"text-orange-400",CSS:"text-blue-300"},c=h=>{h.stopPropagation()};return(h,d)=>{const p=le;return L(),B("a",{href:r.project.url,target:"_blank",ref_key:"target",ref:t,onTouchstart:R(c,["stop"]),onTouchend:R(c,["stop"]),onClick:R(c,["stop"]),style:De({transform:o.value,transition:y(a)?"transform 0.5s ease":"none",animationDelay:`${r.index*50}ms`}),class:"project-card group relative flex flex-col justify-between p-6 bg-surface/40 backdrop-blur-sm border border-white/5 rounded-2xl hover:border-primary/50 active:border-primary/50 hover:shadow-2xl hover:shadow-primary/10 hover:bg-surface/60 active:bg-surface/60 animate-slide-up opacity-0 touch-manipulation"},[d[0]||(d[0]=g("div",{class:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none bg-gradient-to-br from-white/5 to-transparent"},null,-1)),g("div",di,[g("div",ui,[g("div",fi,[H(p,{name:"lucide:folder-git-2",class:"w-6 h-6 text-gray-300 group-hover:text-primary"})]),g("div",pi,[H(p,{name:"lucide:star",class:"w-3.5 h-3.5"}),g("span",gi,C(r.project.stars),1)])]),g("h3",xi,C(r.project.name),1),g("p",yi,C(r.project.description||"No description provided"),1),g("div",vi,[(L(!0),B(Tt,null,Et(r.project.topics.slice(0,3),m=>(L(),B("span",{key:m,class:"text-[10px] px-2 py-0.5 rounded-full bg-white/5 text-gray-400"},C(m),1))),128))])]),g("div",mi,[g("div",bi,[g("span",{class:Lt(["w-2 h-2 rounded-full",r.project.language==="Vue"?"bg-green-500":r.project.language==="TypeScript"?"bg-blue-500":"bg-gray-500"])},null,2),g("span",{class:Lt(["text-xs font-mono",l[r.project.language]||"text-gray-400"])},C(r.project.language||"Code"),3)]),H(p,{name:"lucide:arrow-up-right",class:"w-4 h-4 text-gray-500 group-hover:text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"})])],44,hi)}}}),Mi=Object.assign(ie(wi,[["__scopeId","data-v-549cd2e3"]]),{__name:"ProjectCard"});function Si(r,t,e){const[s={},a]=typeof t=="string"?[{},t]:[t,e],i=Y(()=>N(r)),n=Y(()=>N(s.key)||"$f"+ft([a,typeof i.value=="string"?i.value:"",...Ti(s)]));if(!s.baseURL&&typeof i.value=="string"&&i.value[0]==="/"&&i.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:o,lazy:l,default:c,transform:h,pick:d,watch:p,immediate:m,getCachedData:x,deep:b,dedupe:E,timeout:P,...S}=s,f=$t({...Pe,...S,cache:typeof s.cache=="boolean"?void 0:s.cache}),M={server:o,lazy:l,default:c,transform:h,pick:d,immediate:m,getCachedData:x,deep:b,dedupe:E,timeout:P,watch:p===!1?[]:[...p||[],f]};return Wa(p===!1?n.value:n,(z,{signal:A})=>(s.$fetch||globalThis.$fetch)(i.value,{signal:A,...f}),M)}function Ti(r){const t=[N(r.method)?.toUpperCase()||"GET",N(r.baseURL)];for(const e of[r.query||r.params]){const s=N(e);if(!s)continue;const a={};for(const[i,n]of Object.entries(s))a[N(i)]=N(n);t.push(a)}if(r.body){const e=N(r.body);if(!e)t.push(ft(e));else if(e instanceof ArrayBuffer)t.push(ft(Object.fromEntries([...new Uint8Array(e).entries()].map(([s,a])=>[s,a.toString()]))));else if(e instanceof FormData){const s={};for(const a of e.entries()){const[i,n]=a;s[i]=n instanceof File?n.name:n}t.push(ft(s))}else if(ke(e))t.push(ft($t(e)));else try{t.push(ft(e))}catch{console.warn("[useFetch] Failed to hash body",e)}}return t}const Ei=globalThis.setInterval,Ri={class:"min-h-screen text-white relative selection:bg-primary selection:text-white overflow-x-hidden"},Di=["title"],Pi={class:"relative z-10"},ki={class:"container mx-auto px-6 py-24 max-w-7xl"},Ai={class:"mb-32 max-w-3xl"},Ci={class:"text-2xl md:text-3xl text-gray-400 mb-10 font-light h-20 md:h-auto"},_i={class:"text-white"},Ii={key:0,class:"animate-blink"},Oi={class:"flex flex-wrap gap-4 animate-fade-in-up",style:{"animation-delay":"300ms"}},Li=["href"],Bi={class:"font-medium"},Gi={class:"flex items-end justify-between mb-12 border-b border-white/10 pb-4"},zi={class:"text-3xl font-bold flex items-center gap-3 mb-2"},Hi={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ni={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 perspective-grid"},Fi={class:"mt-12 text-center md:hidden"},$i={class:"mt-40 pt-8 border-t border-white/10 flex flex-col md:flex-row justify-between items-center text-gray-500 text-sm"},Ui={class:"mt-2 md:mt-0 flex items-center gap-2"},se="Backend & Frontend Developer building useful things.",Xi=Ut({__name:"index",async setup(r){let t,e;const{data:s,pending:a}=([t,e]=Ae(()=>Si("/api/projects.json",{default:()=>[]},"$77hSeXQoip")),t=await t,e(),t),i=[{name:"GitHub",url:"https://github.com/s00d",icon:"lucide:github"},{name:"LinkedIn",url:"https://www.linkedin.com/in/s00d/",icon:"lucide:linkedin"},{name:"Telegram",url:"tg://resolve?domain=is_s00d",icon:"lucide:send"},{name:"Email",url:"mailto:Virus191288@gmail.com",icon:"lucide:mail"}],n=lt(""),o=lt(!0),l=lt(!0),c=()=>{l.value=!l.value},h=d=>{d.stopPropagation()};return At(()=>{let d=0;const p=Ei(()=>{d<se.length?(n.value+=se.charAt(d),d++):(clearInterval(p),o.value=!1)},50)}),(d,p)=>{const m=Oa,x=le,b=Mi;return L(),B("div",Ri,[H(m,{showUI:l.value},null,8,["showUI"]),g("button",{onClick:R(c,["stop"]),onTouchstart:R(h,["stop"]),onTouchend:R(c,["stop","prevent"]),class:"fixed top-4 right-4 z-50 w-12 h-12 flex items-center justify-center bg-white/10 backdrop-blur-md rounded-full border border-white/20 hover:bg-white/20 active:bg-white/20 transition-all duration-300 hover:scale-110 group touch-manipulation",title:l.value?"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ":"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ"},[H(x,{name:l.value?"lucide:eye-off":"lucide:eye",class:"w-5 h-5 text-white group-hover:text-primary transition-colors"},null,8,["name"])],40,Di),Ce(g("div",Pi,[g("main",ki,[g("header",Ai,[p[0]||(p[0]=g("div",{class:"animate-fade-in-down"},[g("span",{class:"inline-block px-3 py-1 mb-6 text-xs font-mono font-medium tracking-wider text-primary bg-primary/10 rounded-full border border-primary/20"}," HELLO, WORLD "),g("h1",{class:"text-6xl md:text-8xl font-bold mb-8 tracking-tight leading-tight"},[Q(" Pavel "),g("span",{class:"text-transparent bg-clip-text bg-gradient-to-r from-white via-gray-200 to-gray-500"}," Kuz'min ")])],-1)),g("h2",Ci,[g("span",_i,C(n.value),1),o.value?(L(),B("span",Ii,"|")):ut("",!0)]),g("div",Oi,[(L(),B(Tt,null,Et(i,E=>g("a",{key:E.name,href:E.url,target:"_blank",onTouchstart:R(h,["stop"]),onTouchend:R(h,["stop"]),class:"group flex items-center space-x-2 px-5 py-3 bg-surface/50 backdrop-blur-md rounded-full hover:bg-white/10 active:bg-white/10 border border-white/10 hover:border-primary/50 transition-all duration-300 hover:scale-105 touch-manipulation"},[H(x,{name:E.icon,class:"w-5 h-5 text-gray-300 group-hover:text-primary transition-colors"},null,8,["name"]),g("span",Bi,C(E.name),1)],40,Li)),64))])]),g("section",null,[g("div",Gi,[g("div",null,[g("h2",zi,[H(x,{name:"lucide:code-2",class:"text-primary"}),p[1]||(p[1]=Q(" Selected Projects ",-1))]),p[2]||(p[2]=g("p",{class:"text-gray-400 text-sm"},"Open source contributions and personal labs",-1))]),g("a",{href:"https://github.com/s00d?tab=repositories",target:"_blank",onTouchstart:R(h,["stop"]),onTouchend:R(h,["stop"]),class:"hidden md:flex items-center gap-2 text-sm text-gray-400 hover:text-white active:text-white transition-colors group touch-manipulation"},[p[3]||(p[3]=Q(" View all on GitHub ",-1)),H(x,{name:"lucide:arrow-right",class:"w-4 h-4 group-hover:translate-x-1 transition-transform"})],32)]),y(a)?(L(),B("div",Hi,[(L(),B(Tt,null,Et(6,E=>g("div",{key:E,class:"h-64 bg-white/5 rounded-2xl animate-pulse border border-white/5"})),64))])):(L(),B("div",Ni,[(L(!0),B(Tt,null,Et(y(s),(E,P)=>(L(),Ie(b,{key:E.id,project:E,index:P},null,8,["project","index"]))),128))])),g("div",Fi,[g("a",{href:"https://github.com/s00d?tab=repositories",target:"_blank",onTouchstart:R(h,["stop"]),onTouchend:R(h,["stop"]),class:"inline-flex items-center gap-2 text-sm text-gray-400 hover:text-white active:text-white transition-colors border border-white/10 px-6 py-3 rounded-full touch-manipulation"},[p[4]||(p[4]=Q(" View all on GitHub ",-1)),H(x,{name:"lucide:arrow-right",class:"w-4 h-4"})],32)])]),g("footer",$i,[g("p",null,"Â© "+C(new Date().getFullYear())+" Pavel Kuz'min.",1),g("p",Ui,[p[5]||(p[5]=Q(" Built with ",-1)),H(x,{name:"logos:nuxt-icon",class:"w-4 h-4 grayscale opacity-50"}),p[6]||(p[6]=Q(" Nuxt 3 & Tailwind ",-1))])])])],512),[[_e,l.value]])])}}});export{Xi as default};
